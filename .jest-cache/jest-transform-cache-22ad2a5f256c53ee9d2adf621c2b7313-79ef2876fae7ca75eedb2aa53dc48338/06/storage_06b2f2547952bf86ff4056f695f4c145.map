{"version":3,"names":["_asyncStorage","_interopRequireDefault","require","StorageKeys","exports","PROFILE_COMPLETED","OCD_PROFILE","userId","COMPULSIONS","Terapi_SESSIONS","date","BREATH_SESSIONS","GAMIFICATION","USER_SETTINGS","SETTINGS","LAST_COMPULSION","LAST_Terapi_EXERCISE","CHECKINS","VOICE_CONSENT_STT","VOICE_CONSENT_TTS","THOUGHT_RECORDS","THOUGHT_RECORD_DRAFT","getUserStorageKey","baseKey","saveUserData","_ref","_asyncToGenerator2","default","key","data","storageKey","AsyncStorage","setItem","JSON","stringify","error","console","_x","_x2","_x3","apply","arguments","loadUserData","_ref2","getItem","parse","_x4","_x5","clearUserData","_ref3","keys","getAllKeys","userKeys","filter","includes","length","multiRemove","log","_x6","migrateToUserSpecificStorage","_ref4","oldCompulsions","removeItem","oldSettings","oldGamification","_x7"],"sources":["storage.ts"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\n\n/**\n * Storage utility for managing user-specific data\n * Ensures data isolation between different users\n */\n\nexport const StorageKeys = {\n  // Profile & Auth\n  PROFILE_COMPLETED: 'profileCompleted',\n  OCD_PROFILE: (userId: string) => `ocd_profile_${userId}`,\n  \n  // Compulsions\n  COMPULSIONS: (userId: string) => `compulsions_${userId}`,\n  \n  // Terapi Sessions\n  Terapi_SESSIONS: (userId: string, date?: string) => \n    date ? `therapy_sessions_${userId}_${date}` : `therapy_sessions_${userId}`,\n  \n  // Breathwork Sessions\n  BREATH_SESSIONS: (userId: string, date?: string) =>\n    date ? `breath_sessions_${userId}_${date}` : `breath_sessions_${userId}`,\n  \n  // Gamification\n  GAMIFICATION: (userId: string) => `gamification_${userId}`,\n  \n  // Settings\n  USER_SETTINGS: (userId: string) => `settings_${userId}`,\n  SETTINGS: 'app_settings',\n  \n  // Last used items (for smart suggestions)\n  LAST_COMPULSION: (userId: string) => `last_compulsion_${userId}`,\n  LAST_Terapi_EXERCISE: (userId: string) => `last_therapy_${userId}`,\n\n  // Voice & Check-in\n  CHECKINS: (userId: string) => `checkins_${userId}`,\n  VOICE_CONSENT_STT: (userId: string) => `consent_stt_${userId}`,\n  VOICE_CONSENT_TTS: (userId: string) => `consent_tts_${userId}`,\n\n  // CBT Thought Record\n  THOUGHT_RECORDS: (userId: string) => `thought_records_${userId}`,\n  THOUGHT_RECORD_DRAFT: (userId: string) => `thought_record_draft_${userId}`,\n} as const;\n\n/**\n * Get user-specific storage key\n */\nexport const getUserStorageKey = (baseKey: string, userId?: string): string => {\n  if (!userId || typeof userId !== 'string') {\n    // Fallback: ensure string key to avoid AsyncStorage undefined warnings\n    return `${baseKey}_anon`;\n  }\n  return `${baseKey}_${userId}`;\n};\n\n/**\n * Save user-specific data\n */\nexport const saveUserData = async <T>(\n  key: string, \n  data: T, \n  userId?: string\n): Promise<void> => {\n  try {\n    const storageKey = userId ? getUserStorageKey(key, userId) : key;\n    await AsyncStorage.setItem(storageKey, JSON.stringify(data));\n  } catch (error) {\n    console.error(`❌ Error saving data for key ${key}:`, error);\n    throw error;\n  }\n};\n\n/**\n * Load user-specific data\n */\nexport const loadUserData = async <T>(\n  key: string, \n  userId?: string\n): Promise<T | null> => {\n  try {\n    const storageKey = userId ? getUserStorageKey(key, userId) : key;\n    const data = await AsyncStorage.getItem(storageKey);\n    return data ? JSON.parse(data) : null;\n  } catch (error) {\n    console.error(`❌ Error loading data for key ${key}:`, error);\n    return null;\n  }\n};\n\n/**\n * Clear all user-specific data (for logout)\n */\nexport const clearUserData = async (userId: string): Promise<void> => {\n  try {\n    const keys = await AsyncStorage.getAllKeys();\n    const userKeys = keys.filter(key => key.includes(`_${userId}`));\n    \n    if (userKeys.length > 0) {\n      await AsyncStorage.multiRemove(userKeys);\n      console.log(`✅ Cleared ${userKeys.length} keys for user ${userId}`);\n    }\n  } catch (error) {\n    console.error('❌ Error clearing user data:', error);\n    throw error;\n  }\n};\n\n/**\n * Migrate old data to user-specific keys\n */\nexport const migrateToUserSpecificStorage = async (userId: string): Promise<void> => {\n  try {\n    // Migrate compulsions\n    const oldCompulsions = await AsyncStorage.getItem('compulsionEntries');\n    if (oldCompulsions) {\n      await AsyncStorage.setItem(StorageKeys.COMPULSIONS(userId), oldCompulsions);\n      await AsyncStorage.removeItem('compulsionEntries');\n      console.log('✅ Migrated compulsions data');\n    }\n    \n    // Migrate settings\n    const oldSettings = await AsyncStorage.getItem('user_settings');\n    if (oldSettings) {\n      await AsyncStorage.setItem(StorageKeys.USER_SETTINGS(userId), oldSettings);\n      await AsyncStorage.removeItem('user_settings');\n      console.log('✅ Migrated settings data');\n    }\n    \n    // Migrate gamification\n    const oldGamification = await AsyncStorage.getItem('gamification_profile');\n    if (oldGamification) {\n      await AsyncStorage.setItem(StorageKeys.GAMIFICATION(userId), oldGamification);\n      await AsyncStorage.removeItem('gamification_profile');\n      console.log('✅ Migrated gamification data');\n    }\n  } catch (error) {\n    console.error('❌ Error during migration:', error);\n  }\n}; "],"mappings":"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","ignoreList":[]}