ec210eb64b8c75ad46079d5ab465a2dd
var _userRowMapper = require("../../utils/userRowMapper");
describe('Signup â†’ users row mapping', function () {
  test('buildUsersUpsertRow maps auth user to users table row', function () {
    var authUser = {
      id: 'user-xyz',
      email: 'new.user@test.dev',
      user_metadata: {
        name: 'New User'
      },
      app_metadata: {
        provider: 'email'
      }
    };
    var row = (0, _userRowMapper.buildUsersUpsertRow)(authUser);
    expect(row).toMatchObject({
      id: 'user-xyz',
      email: 'new.user@test.dev',
      name: 'New User',
      provider: 'email'
    });
    expect(typeof row.created_at).toBe('string');
    expect(typeof row.updated_at).toBe('string');
  });
  test('falls back to email prefix when name missing', function () {
    var authUser = {
      id: 'user-abc',
      email: 'someone@example.com',
      user_metadata: {},
      app_metadata: {}
    };
    var row = (0, _userRowMapper.buildUsersUpsertRow)(authUser);
    expect(row.name).toBe('someone');
    expect(row.provider).toBe('email');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXNlclJvd01hcHBlciIsInJlcXVpcmUiLCJkZXNjcmliZSIsInRlc3QiLCJhdXRoVXNlciIsImlkIiwiZW1haWwiLCJ1c2VyX21ldGFkYXRhIiwibmFtZSIsImFwcF9tZXRhZGF0YSIsInByb3ZpZGVyIiwicm93IiwiYnVpbGRVc2Vyc1Vwc2VydFJvdyIsImV4cGVjdCIsInRvTWF0Y2hPYmplY3QiLCJjcmVhdGVkX2F0IiwidG9CZSIsInVwZGF0ZWRfYXQiXSwic291cmNlcyI6WyJzaWdudXBfZ2FtaWZpY2F0aW9uX3N1cGFiYXNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRVc2Vyc1Vwc2VydFJvdyB9IGZyb20gJ0AvdXRpbHMvdXNlclJvd01hcHBlcic7XG5cbmRlc2NyaWJlKCdTaWdudXAg4oaSIHVzZXJzIHJvdyBtYXBwaW5nJywgKCkgPT4ge1xuICB0ZXN0KCdidWlsZFVzZXJzVXBzZXJ0Um93IG1hcHMgYXV0aCB1c2VyIHRvIHVzZXJzIHRhYmxlIHJvdycsICgpID0+IHtcbiAgICBjb25zdCBhdXRoVXNlcjogYW55ID0ge1xuICAgICAgaWQ6ICd1c2VyLXh5eicsXG4gICAgICBlbWFpbDogJ25ldy51c2VyQHRlc3QuZGV2JyxcbiAgICAgIHVzZXJfbWV0YWRhdGE6IHsgbmFtZTogJ05ldyBVc2VyJyB9LFxuICAgICAgYXBwX21ldGFkYXRhOiB7IHByb3ZpZGVyOiAnZW1haWwnIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHJvdyA9IGJ1aWxkVXNlcnNVcHNlcnRSb3coYXV0aFVzZXIpO1xuICAgIGV4cGVjdChyb3cpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgaWQ6ICd1c2VyLXh5eicsXG4gICAgICBlbWFpbDogJ25ldy51c2VyQHRlc3QuZGV2JyxcbiAgICAgIG5hbWU6ICdOZXcgVXNlcicsXG4gICAgICBwcm92aWRlcjogJ2VtYWlsJyxcbiAgICB9KTtcbiAgICBleHBlY3QodHlwZW9mIHJvdy5jcmVhdGVkX2F0KS50b0JlKCdzdHJpbmcnKTtcbiAgICBleHBlY3QodHlwZW9mIHJvdy51cGRhdGVkX2F0KS50b0JlKCdzdHJpbmcnKTtcbiAgfSk7XG5cbiAgdGVzdCgnZmFsbHMgYmFjayB0byBlbWFpbCBwcmVmaXggd2hlbiBuYW1lIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgYXV0aFVzZXI6IGFueSA9IHtcbiAgICAgIGlkOiAndXNlci1hYmMnLFxuICAgICAgZW1haWw6ICdzb21lb25lQGV4YW1wbGUuY29tJyxcbiAgICAgIHVzZXJfbWV0YWRhdGE6IHt9LFxuICAgICAgYXBwX21ldGFkYXRhOiB7fSxcbiAgICB9O1xuICAgIGNvbnN0IHJvdyA9IGJ1aWxkVXNlcnNVcHNlcnRSb3coYXV0aFVzZXIpO1xuICAgIGV4cGVjdChyb3cubmFtZSkudG9CZSgnc29tZW9uZScpO1xuICAgIGV4cGVjdChyb3cucHJvdmlkZXIpLnRvQmUoJ2VtYWlsJyk7XG4gIH0pO1xufSk7XG5cbiJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQUEsY0FBQSxHQUFBQyxPQUFBO0FBRUFDLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxZQUFNO0VBQzNDQyxJQUFJLENBQUMsdURBQXVELEVBQUUsWUFBTTtJQUNsRSxJQUFNQyxRQUFhLEdBQUc7TUFDcEJDLEVBQUUsRUFBRSxVQUFVO01BQ2RDLEtBQUssRUFBRSxtQkFBbUI7TUFDMUJDLGFBQWEsRUFBRTtRQUFFQyxJQUFJLEVBQUU7TUFBVyxDQUFDO01BQ25DQyxZQUFZLEVBQUU7UUFBRUMsUUFBUSxFQUFFO01BQVE7SUFDcEMsQ0FBQztJQUVELElBQU1DLEdBQUcsR0FBRyxJQUFBQyxrQ0FBbUIsRUFBQ1IsUUFBUSxDQUFDO0lBQ3pDUyxNQUFNLENBQUNGLEdBQUcsQ0FBQyxDQUFDRyxhQUFhLENBQUM7TUFDeEJULEVBQUUsRUFBRSxVQUFVO01BQ2RDLEtBQUssRUFBRSxtQkFBbUI7TUFDMUJFLElBQUksRUFBRSxVQUFVO01BQ2hCRSxRQUFRLEVBQUU7SUFDWixDQUFDLENBQUM7SUFDRkcsTUFBTSxDQUFDLE9BQU9GLEdBQUcsQ0FBQ0ksVUFBVSxDQUFDLENBQUNDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDNUNILE1BQU0sQ0FBQyxPQUFPRixHQUFHLENBQUNNLFVBQVUsQ0FBQyxDQUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDO0VBQzlDLENBQUMsQ0FBQztFQUVGYixJQUFJLENBQUMsOENBQThDLEVBQUUsWUFBTTtJQUN6RCxJQUFNQyxRQUFhLEdBQUc7TUFDcEJDLEVBQUUsRUFBRSxVQUFVO01BQ2RDLEtBQUssRUFBRSxxQkFBcUI7TUFDNUJDLGFBQWEsRUFBRSxDQUFDLENBQUM7TUFDakJFLFlBQVksRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFDRCxJQUFNRSxHQUFHLEdBQUcsSUFBQUMsa0NBQW1CLEVBQUNSLFFBQVEsQ0FBQztJQUN6Q1MsTUFBTSxDQUFDRixHQUFHLENBQUNILElBQUksQ0FBQyxDQUFDUSxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ2hDSCxNQUFNLENBQUNGLEdBQUcsQ0FBQ0QsUUFBUSxDQUFDLENBQUNNLElBQUksQ0FBQyxPQUFPLENBQUM7RUFDcEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119