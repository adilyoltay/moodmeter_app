b32d8fea0088fd790e44ac52138ea52b
_getJestObj().mock("../../services/supabase", function () {
  return {
    __esModule: true,
    default: {
      supabaseClient: {
        from: jest.fn(function () {
          return {
            select: jest.fn(function () {
              return {
                eq: jest.fn(function () {
                  return {
                    maybeSingle: jest.fn((0, _asyncToGenerator2.default)(function* () {
                      return {
                        data: null,
                        error: null
                      };
                    }))
                  };
                })
              };
            }),
            upsert: jest.fn((0, _asyncToGenerator2.default)(function* () {
              return {
                data: null,
                error: null
              };
            })),
            delete: jest.fn(function () {
              return {
                eq: jest.fn((0, _asyncToGenerator2.default)(function* () {
                  return {
                    data: null,
                    error: null
                  };
                }))
              };
            }),
            like: jest.fn(function () {
              return {
                delete: jest.fn(function () {
                  return {
                    eq: jest.fn((0, _asyncToGenerator2.default)(function* () {
                      return {
                        data: null,
                        error: null
                      };
                    }))
                  };
                })
              };
            }),
            eq: jest.fn(function () {
              return {
                maybeSingle: jest.fn((0, _asyncToGenerator2.default)(function* () {
                  return {
                    data: null,
                    error: null
                  };
                }))
              };
            })
          };
        })
      }
    }
  };
});
_getJestObj().mock("../../features/ai/services/checkinService", function () {
  return {
    __esModule: true,
    unifiedVoiceAnalysis: jest.fn((0, _asyncToGenerator2.default)(function* () {
      throw new Error('forced voice analysis failure');
    }))
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _UnifiedAIPipeline = require("../../features/ai/core/UnifiedAIPipeline");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
var actualTelemetry = jest.requireActual("../../features/ai/telemetry/aiTelemetry");
describe('System Voice - Unified Pipeline', function () {
  beforeAll(function () {
    process.env.TEST_MODE = '1';
    process.env.TEST_TTL_MS = '5000';
    process.env.TEST_PIPELINE_STUB = '0';
    process.env.TEST_SEED_USER_ID = process.env.TEST_SEED_USER_ID || 'test-user-1';
    process.env.EXPO_PUBLIC_ENABLE_AI = 'true';
  });
  beforeEach((0, _asyncToGenerator2.default)(function* () {
    jest.clearAllMocks();
    yield _asyncStorage.default.clear();
  }));
  it('[QRsys:voice:fallback] uses heuristic fallback when voice analysis fails', (0, _asyncToGenerator2.default)(function* () {
    var _result$voice;
    var userId = process.env.TEST_SEED_USER_ID || 'test-user-1';
    var text = 'Bug√ºn biraz yorgun ve stresliyim, nefes egzersizi iyi gelebilir.';
    var result = yield _UnifiedAIPipeline.unifiedPipeline.process({
      userId: userId,
      type: 'voice',
      content: text,
      context: {
        source: 'today'
      }
    });
    expect(result.metadata.source).toBe('fresh');
    expect(result.voice).toBeDefined();
    expect((_result$voice = result.voice) == null ? void 0 : _result$voice.suggestion).toContain('Heuristic');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInN1cGFiYXNlQ2xpZW50IiwiZnJvbSIsImplc3QiLCJmbiIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkYXRhIiwiZXJyb3IiLCJ1cHNlcnQiLCJkZWxldGUiLCJsaWtlIiwidW5pZmllZFZvaWNlQW5hbHlzaXMiLCJFcnJvciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9VbmlmaWVkQUlQaXBlbGluZSIsIl9yZXF1aXJlIiwiYWN0dWFsVGVsZW1ldHJ5IiwicmVxdWlyZUFjdHVhbCIsImRlc2NyaWJlIiwiYmVmb3JlQWxsIiwicHJvY2VzcyIsImVudiIsIlRFU1RfTU9ERSIsIlRFU1RfVFRMX01TIiwiVEVTVF9QSVBFTElORV9TVFVCIiwiVEVTVF9TRUVEX1VTRVJfSUQiLCJFWFBPX1BVQkxJQ19FTkFCTEVfQUkiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIkFzeW5jU3RvcmFnZSIsImNsZWFyIiwiaXQiLCJfcmVzdWx0JHZvaWNlIiwidXNlcklkIiwidGV4dCIsInJlc3VsdCIsInVuaWZpZWRQaXBlbGluZSIsInR5cGUiLCJjb250ZW50IiwiY29udGV4dCIsInNvdXJjZSIsImV4cGVjdCIsIm1ldGFkYXRhIiwidG9CZSIsInZvaWNlIiwidG9CZURlZmluZWQiLCJzdWdnZXN0aW9uIiwidG9Db250YWluIl0sInNvdXJjZXMiOlsiU3lzdGVtVm9pY2VQaXBlbGluZS5zcGVjLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfp6ogU3lzdGVtLU1vZGUgVGVzdHMg4oCUIFZvaWNlIChSZWFsIFVuaWZpZWRBSVBpcGVsaW5lKVxuICpcbiAqIE1pbmltYWwgZmFsbGJhY2sgcGF0aCB2YWxpZGF0aW9uIGZvciB2b2ljZSBhbmFseXNpcyB0byBjbGVhciBTeXN0ZW0gVm9pY2UgZ2F0aW5nLlxuICogVGFnOiBbUVJzeXM6dm9pY2U6ZmFsbGJhY2tdXG4gKi9cblxuaW1wb3J0IEFzeW5jU3RvcmFnZSBmcm9tICdAcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvYXN5bmMtc3RvcmFnZSc7XG5pbXBvcnQgeyB1bmlmaWVkUGlwZWxpbmUgfSBmcm9tICdAL2ZlYXR1cmVzL2FpL2NvcmUvVW5pZmllZEFJUGlwZWxpbmUnO1xuXG4vLyBLZWVwIGFjdHVhbCBlbnVtcyBhdmFpbGFibGVcbmNvbnN0IGFjdHVhbFRlbGVtZXRyeSA9IGplc3QucmVxdWlyZUFjdHVhbCgnQC9mZWF0dXJlcy9haS90ZWxlbWV0cnkvYWlUZWxlbWV0cnknKTtcblxuLy8gTW9jayBTdXBhYmFzZSB0byBhdm9pZCBuZXR3b3JrXG5qZXN0Lm1vY2soJ0Avc2VydmljZXMvc3VwYWJhc2UnLCAoKSA9PiAoe1xuICBfX2VzTW9kdWxlOiB0cnVlLFxuICBkZWZhdWx0OiB7XG4gICAgc3VwYWJhc2VDbGllbnQ6IHtcbiAgICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7IGVxOiBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlOiBqZXN0LmZuKGFzeW5jICgpID0+ICh7IGRhdGE6IG51bGwsIGVycm9yOiBudWxsIH0pKSB9KSkgfSkpLFxuICAgICAgICB1cHNlcnQ6IGplc3QuZm4oYXN5bmMgKCkgPT4gKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSkpLFxuICAgICAgICBkZWxldGU6IGplc3QuZm4oKCkgPT4gKHsgZXE6IGplc3QuZm4oYXN5bmMgKCkgPT4gKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSkpIH0pKSxcbiAgICAgICAgbGlrZTogamVzdC5mbigoKSA9PiAoeyBkZWxldGU6IGplc3QuZm4oKCkgPT4gKHsgZXE6IGplc3QuZm4oYXN5bmMgKCkgPT4gKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSkpIH0pKSB9KSksXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlOiBqZXN0LmZuKGFzeW5jICgpID0+ICh7IGRhdGE6IG51bGwsIGVycm9yOiBudWxsIH0pKSB9KSksXG4gICAgICB9KSlcbiAgICB9XG4gIH1cbn0pKTtcblxuLy8gRm9yY2UgdGhlIHZvaWNlIG1vZHVsZSB0byB0aHJvdyBzbyBwaXBlbGluZSB1c2VzIGhldXJpc3RpYyBmYWxsYmFja1xuamVzdC5tb2NrKCdAL2ZlYXR1cmVzL2FpL3NlcnZpY2VzL2NoZWNraW5TZXJ2aWNlJywgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgdW5pZmllZFZvaWNlQW5hbHlzaXM6IGplc3QuZm4oYXN5bmMgKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ2ZvcmNlZCB2b2ljZSBhbmFseXNpcyBmYWlsdXJlJyk7IH0pXG59KSk7XG5cbmRlc2NyaWJlKCdTeXN0ZW0gVm9pY2UgLSBVbmlmaWVkIFBpcGVsaW5lJywgKCkgPT4ge1xuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIHByb2Nlc3MuZW52LlRFU1RfTU9ERSA9ICcxJztcbiAgICBwcm9jZXNzLmVudi5URVNUX1RUTF9NUyA9ICc1MDAwJztcbiAgICBwcm9jZXNzLmVudi5URVNUX1BJUEVMSU5FX1NUVUIgPSAnMCc7XG4gICAgcHJvY2Vzcy5lbnYuVEVTVF9TRUVEX1VTRVJfSUQgPSBwcm9jZXNzLmVudi5URVNUX1NFRURfVVNFUl9JRCB8fCAndGVzdC11c2VyLTEnO1xuICAgIHByb2Nlc3MuZW52LkVYUE9fUFVCTElDX0VOQUJMRV9BSSA9ICd0cnVlJztcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgYXdhaXQgKEFzeW5jU3RvcmFnZSBhcyBhbnkpLmNsZWFyKCk7XG4gIH0pO1xuXG4gIGl0KCdbUVJzeXM6dm9pY2U6ZmFsbGJhY2tdIHVzZXMgaGV1cmlzdGljIGZhbGxiYWNrIHdoZW4gdm9pY2UgYW5hbHlzaXMgZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlcklkID0gcHJvY2Vzcy5lbnYuVEVTVF9TRUVEX1VTRVJfSUQgfHwgJ3Rlc3QtdXNlci0xJztcbiAgICBjb25zdCB0ZXh0ID0gJ0J1Z8O8biBiaXJheiB5b3JndW4gdmUgc3RyZXNsaXlpbSwgbmVmZXMgZWd6ZXJzaXppIGl5aSBnZWxlYmlsaXIuJztcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVuaWZpZWRQaXBlbGluZS5wcm9jZXNzKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHR5cGU6ICd2b2ljZScsXG4gICAgICBjb250ZW50OiB0ZXh0LFxuICAgICAgY29udGV4dDogeyBzb3VyY2U6ICd0b2RheScgfVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YS5zb3VyY2UpLnRvQmUoJ2ZyZXNoJyk7XG4gICAgZXhwZWN0KHJlc3VsdC52b2ljZSkudG9CZURlZmluZWQoKTtcbiAgICAvLyBIZXVyaXN0aWMgZ2VuZXJhdG9yIHNldHMgYSBnZW5lcmljIHN1Z2dlc3Rpb25cbiAgICBleHBlY3QocmVzdWx0LnZvaWNlPy5zdWdnZXN0aW9uKS50b0NvbnRhaW4oJ0hldXJpc3RpYycpO1xuICB9KTtcbn0pO1xuXG4iXSwibWFwcGluZ3MiOiJBQWNBQSxXQUFBLEdBQUtDLElBQUksNEJBQXdCO0VBQUEsT0FBTztJQUN0Q0MsVUFBVSxFQUFFLElBQUk7SUFDaEJDLE9BQU8sRUFBRTtNQUNQQyxjQUFjLEVBQUU7UUFDZEMsSUFBSSxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQztVQUFBLE9BQU87WUFDbkJDLE1BQU0sRUFBRUYsSUFBSSxDQUFDQyxFQUFFLENBQUM7Y0FBQSxPQUFPO2dCQUFFRSxFQUFFLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFDO2tCQUFBLE9BQU87b0JBQUVHLFdBQVcsRUFBRUosSUFBSSxDQUFDQyxFQUFFLEtBQUFJLGtCQUFBLENBQUFSLE9BQUEsRUFBQztzQkFBQSxPQUFhO3dCQUFFUyxJQUFJLEVBQUUsSUFBSTt3QkFBRUMsS0FBSyxFQUFFO3NCQUFLLENBQUM7b0JBQUEsQ0FBQztrQkFBRSxDQUFDO2dCQUFBLENBQUM7Y0FBRSxDQUFDO1lBQUEsQ0FBQyxDQUFDO1lBQ3JIQyxNQUFNLEVBQUVSLElBQUksQ0FBQ0MsRUFBRSxLQUFBSSxrQkFBQSxDQUFBUixPQUFBLEVBQUM7Y0FBQSxPQUFhO2dCQUFFUyxJQUFJLEVBQUUsSUFBSTtnQkFBRUMsS0FBSyxFQUFFO2NBQUssQ0FBQztZQUFBLENBQUMsRUFBQztZQUMxREUsTUFBTSxFQUFFVCxJQUFJLENBQUNDLEVBQUUsQ0FBQztjQUFBLE9BQU87Z0JBQUVFLEVBQUUsRUFBRUgsSUFBSSxDQUFDQyxFQUFFLEtBQUFJLGtCQUFBLENBQUFSLE9BQUEsRUFBQztrQkFBQSxPQUFhO29CQUFFUyxJQUFJLEVBQUUsSUFBSTtvQkFBRUMsS0FBSyxFQUFFO2tCQUFLLENBQUM7Z0JBQUEsQ0FBQztjQUFFLENBQUM7WUFBQSxDQUFDLENBQUM7WUFDbkZHLElBQUksRUFBRVYsSUFBSSxDQUFDQyxFQUFFLENBQUM7Y0FBQSxPQUFPO2dCQUFFUSxNQUFNLEVBQUVULElBQUksQ0FBQ0MsRUFBRSxDQUFDO2tCQUFBLE9BQU87b0JBQUVFLEVBQUUsRUFBRUgsSUFBSSxDQUFDQyxFQUFFLEtBQUFJLGtCQUFBLENBQUFSLE9BQUEsRUFBQztzQkFBQSxPQUFhO3dCQUFFUyxJQUFJLEVBQUUsSUFBSTt3QkFBRUMsS0FBSyxFQUFFO3NCQUFLLENBQUM7b0JBQUEsQ0FBQztrQkFBRSxDQUFDO2dCQUFBLENBQUM7Y0FBRSxDQUFDO1lBQUEsQ0FBQyxDQUFDO1lBQzlHSixFQUFFLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFDO2NBQUEsT0FBTztnQkFBRUcsV0FBVyxFQUFFSixJQUFJLENBQUNDLEVBQUUsS0FBQUksa0JBQUEsQ0FBQVIsT0FBQSxFQUFDO2tCQUFBLE9BQWE7b0JBQUVTLElBQUksRUFBRSxJQUFJO29CQUFFQyxLQUFLLEVBQUU7a0JBQUssQ0FBQztnQkFBQSxDQUFDO2NBQUUsQ0FBQztZQUFBLENBQUM7VUFDekYsQ0FBQztRQUFBLENBQUM7TUFDSjtJQUNGO0VBQ0YsQ0FBQztBQUFBLENBQUMsQ0FBQztBQUdIYixXQUFBLEdBQUtDLElBQUksOENBQTBDO0VBQUEsT0FBTztJQUN4REMsVUFBVSxFQUFFLElBQUk7SUFDaEJlLG9CQUFvQixFQUFFWCxJQUFJLENBQUNDLEVBQUUsS0FBQUksa0JBQUEsQ0FBQVIsT0FBQSxFQUFDLGFBQVk7TUFBRSxNQUFNLElBQUllLEtBQUssQ0FBQywrQkFBK0IsQ0FBQztJQUFFLENBQUM7RUFDakcsQ0FBQztBQUFBLENBQUMsQ0FBQztBQUFDLElBQUFDLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBVCxrQkFBQSxHQUFBUSxzQkFBQSxDQUFBQyxPQUFBO0FBMUJKLElBQUFDLGFBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLGtCQUFBLEdBQUFGLE9BQUE7QUFBdUUsU0FBQXBCLFlBQUE7RUFBQSxJQUFBdUIsUUFBQSxHQUFBSCxPQUFBO0lBQUFkLElBQUEsR0FBQWlCLFFBQUEsQ0FBQWpCLElBQUE7RUFBQU4sV0FBQSxZQUFBQSxZQUFBO0lBQUEsT0FBQU0sSUFBQTtFQUFBO0VBQUEsT0FBQUEsSUFBQTtBQUFBO0FBR3ZFLElBQU1rQixlQUFlLEdBQUdsQixJQUFJLENBQUNtQixhQUFhLDBDQUFzQyxDQUFDO0FBd0JqRkMsUUFBUSxDQUFDLGlDQUFpQyxFQUFFLFlBQU07RUFDaERDLFNBQVMsQ0FBQyxZQUFNO0lBQ2RDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxTQUFTLEdBQUcsR0FBRztJQUMzQkYsT0FBTyxDQUFDQyxHQUFHLENBQUNFLFdBQVcsR0FBRyxNQUFNO0lBQ2hDSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csa0JBQWtCLEdBQUcsR0FBRztJQUNwQ0osT0FBTyxDQUFDQyxHQUFHLENBQUNJLGlCQUFpQixHQUFHTCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0ksaUJBQWlCLElBQUksYUFBYTtJQUM5RUwsT0FBTyxDQUFDQyxHQUFHLENBQUNLLHFCQUFxQixHQUFHLE1BQU07RUFDNUMsQ0FBQyxDQUFDO0VBRUZDLFVBQVUsS0FBQXhCLGtCQUFBLENBQUFSLE9BQUEsRUFBQyxhQUFZO0lBQ3JCRyxJQUFJLENBQUM4QixhQUFhLENBQUMsQ0FBQztJQUNwQixNQUFPQyxxQkFBWSxDQUFTQyxLQUFLLENBQUMsQ0FBQztFQUNyQyxDQUFDLEVBQUM7RUFFRkMsRUFBRSxDQUFDLDBFQUEwRSxNQUFBNUIsa0JBQUEsQ0FBQVIsT0FBQSxFQUFFLGFBQVk7SUFBQSxJQUFBcUMsYUFBQTtJQUN6RixJQUFNQyxNQUFNLEdBQUdiLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSSxpQkFBaUIsSUFBSSxhQUFhO0lBQzdELElBQU1TLElBQUksR0FBRyxrRUFBa0U7SUFFL0UsSUFBTUMsTUFBTSxTQUFTQyxrQ0FBZSxDQUFDaEIsT0FBTyxDQUFDO01BQzNDYSxNQUFNLEVBQU5BLE1BQU07TUFDTkksSUFBSSxFQUFFLE9BQU87TUFDYkMsT0FBTyxFQUFFSixJQUFJO01BQ2JLLE9BQU8sRUFBRTtRQUFFQyxNQUFNLEVBQUU7TUFBUTtJQUM3QixDQUFDLENBQUM7SUFFRkMsTUFBTSxDQUFDTixNQUFNLENBQUNPLFFBQVEsQ0FBQ0YsTUFBTSxDQUFDLENBQUNHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDNUNGLE1BQU0sQ0FBQ04sTUFBTSxDQUFDUyxLQUFLLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7SUFFbENKLE1BQU0sRUFBQVQsYUFBQSxHQUFDRyxNQUFNLENBQUNTLEtBQUsscUJBQVpaLGFBQUEsQ0FBY2MsVUFBVSxDQUFDLENBQUNDLFNBQVMsQ0FBQyxXQUFXLENBQUM7RUFDekQsQ0FBQyxFQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119