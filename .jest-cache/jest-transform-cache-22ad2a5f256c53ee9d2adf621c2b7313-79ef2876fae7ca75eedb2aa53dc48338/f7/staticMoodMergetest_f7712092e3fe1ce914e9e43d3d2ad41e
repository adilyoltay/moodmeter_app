e51a100b2fdd3c725e7d3510411a5e15
_getJestObj().mock("../../services/moodDeletionCache");
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _staticMoodMerge = require("../../services/staticMoodMerge");
var _moodDeletionCache = require("../../services/moodDeletionCache");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe('Static Mood Merge - P0 Deduplication Fixes', function () {
  var mockUserId = 'test-user-123';
  beforeEach(function () {
    jest.clearAllMocks();
    _moodDeletionCache.moodDeletionCache.getRecentlyDeletedIds.mockResolvedValue([]);
  });
  describe('Content Hash Deduplication', function () {
    it('should deduplicate entries with same content_hash', (0, _asyncToGenerator2.default)(function* () {
      var localEntry = {
        id: 'mood_local_123',
        local_id: 'mood_local_123',
        content_hash: 'abc123hash',
        user_id: mockUserId,
        mood_score: 75,
        energy_level: 80,
        anxiety_level: 30,
        notes: 'Test entry',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: false,
        sync_attempts: 0
      };
      var remoteEntry = {
        id: 'uuid-remote-456',
        remote_id: 'uuid-remote-456',
        content_hash: 'abc123hash',
        user_id: mockUserId,
        mood_score: 75,
        energy_level: 80,
        anxiety_level: 30,
        notes: 'Test entry',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: true,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([localEntry], [remoteEntry], mockUserId);
      expect(result.mergedEntries).toHaveLength(1);
      expect(result.mergedEntries[0].id).toBe('uuid-remote-456');
      expect(result.stats.duplicatesRemoved).toBe(1);
    }));
    it('should deduplicate by remote_id mapping', (0, _asyncToGenerator2.default)(function* () {
      var localEntry = {
        id: 'mood_local_123',
        local_id: 'mood_local_123',
        remote_id: 'uuid-shared-789',
        user_id: mockUserId,
        mood_score: 75,
        energy_level: 80,
        anxiety_level: 30,
        notes: 'Test entry',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: true,
        sync_attempts: 0
      };
      var remoteEntry = {
        id: 'uuid-shared-789',
        remote_id: 'uuid-shared-789',
        user_id: mockUserId,
        mood_score: 75,
        energy_level: 80,
        anxiety_level: 30,
        notes: 'Test entry',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: true,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([localEntry], [remoteEntry], mockUserId);
      expect(result.mergedEntries).toHaveLength(1);
      expect(result.mergedEntries[0].id).toBe('uuid-shared-789');
      expect(result.stats.duplicatesRemoved).toBe(0);
    }));
  });
  describe('Deletion Cache Integration', function () {
    it('should filter out recently deleted entries', (0, _asyncToGenerator2.default)(function* () {
      var deletedId = 'deleted-entry-123';
      _moodDeletionCache.moodDeletionCache.getRecentlyDeletedIds.mockResolvedValue([deletedId]);
      var localEntry = {
        id: deletedId,
        user_id: mockUserId,
        mood_score: 50,
        energy_level: 50,
        anxiety_level: 50,
        notes: 'Should be filtered',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: false,
        sync_attempts: 0
      };
      var remoteEntry = {
        id: deletedId,
        user_id: mockUserId,
        mood_score: 50,
        energy_level: 50,
        anxiety_level: 50,
        notes: 'Should be filtered',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: true,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([localEntry], [remoteEntry], mockUserId);
      expect(result.mergedEntries).toHaveLength(0);
      expect(_moodDeletionCache.moodDeletionCache.getRecentlyDeletedIds).toHaveBeenCalledWith(mockUserId);
    }));
    it('should filter by local_id and remote_id mappings in deletion cache', (0, _asyncToGenerator2.default)(function* () {
      var deletedLocalId = 'mood_deleted_456';
      _moodDeletionCache.moodDeletionCache.getRecentlyDeletedIds.mockResolvedValue([deletedLocalId]);
      var localEntry = {
        id: 'some-other-id',
        local_id: deletedLocalId,
        user_id: mockUserId,
        mood_score: 60,
        energy_level: 60,
        anxiety_level: 40,
        notes: 'Should be filtered by local_id',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T12:00:00Z',
        synced: false,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([localEntry], [], mockUserId);
      expect(result.mergedEntries).toHaveLength(0);
    }));
  });
  describe('Edge Cases', function () {
    it('should handle entries without content_hash gracefully', (0, _asyncToGenerator2.default)(function* () {
      var entryWithoutHash = {
        id: 'no-hash-entry',
        user_id: mockUserId,
        mood_score: 70,
        energy_level: 70,
        anxiety_level: 20,
        notes: 'No content hash',
        triggers: ['work'],
        activities: ['exercise'],
        timestamp: '2025-08-30T14:00:00Z',
        synced: false,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([entryWithoutHash], [], mockUserId);
      expect(result.mergedEntries).toHaveLength(1);
      expect(result.mergedEntries[0].id).toBe('no-hash-entry');
    }));
    it('should handle missing userId gracefully', (0, _asyncToGenerator2.default)(function* () {
      var entry = {
        id: 'test-entry',
        user_id: mockUserId,
        mood_score: 80,
        energy_level: 75,
        anxiety_level: 25,
        notes: 'Test without userId',
        triggers: [],
        activities: [],
        timestamp: '2025-08-30T15:00:00Z',
        synced: false,
        sync_attempts: 0
      };
      var result = yield (0, _staticMoodMerge.intelligentMoodMerge)([entry], [], undefined);
      expect(result.mergedEntries).toHaveLength(1);
      expect(_moodDeletionCache.moodDeletionCache.getRecentlyDeletedIds).not.toHaveBeenCalled();
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9zdGF0aWNNb29kTWVyZ2UiLCJfbW9vZERlbGV0aW9uQ2FjaGUiLCJfcmVxdWlyZSIsImplc3QiLCJkZXNjcmliZSIsIm1vY2tVc2VySWQiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIm1vb2REZWxldGlvbkNhY2hlIiwiZ2V0UmVjZW50bHlEZWxldGVkSWRzIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJpdCIsImRlZmF1bHQiLCJsb2NhbEVudHJ5IiwiaWQiLCJsb2NhbF9pZCIsImNvbnRlbnRfaGFzaCIsInVzZXJfaWQiLCJtb29kX3Njb3JlIiwiZW5lcmd5X2xldmVsIiwiYW54aWV0eV9sZXZlbCIsIm5vdGVzIiwidHJpZ2dlcnMiLCJhY3Rpdml0aWVzIiwidGltZXN0YW1wIiwic3luY2VkIiwic3luY19hdHRlbXB0cyIsInJlbW90ZUVudHJ5IiwicmVtb3RlX2lkIiwicmVzdWx0IiwiaW50ZWxsaWdlbnRNb29kTWVyZ2UiLCJleHBlY3QiLCJtZXJnZWRFbnRyaWVzIiwidG9IYXZlTGVuZ3RoIiwidG9CZSIsInN0YXRzIiwiZHVwbGljYXRlc1JlbW92ZWQiLCJkZWxldGVkSWQiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsImRlbGV0ZWRMb2NhbElkIiwiZW50cnlXaXRob3V0SGFzaCIsImVudHJ5IiwidW5kZWZpbmVkIiwibm90IiwidG9IYXZlQmVlbkNhbGxlZCJdLCJzb3VyY2VzIjpbInN0YXRpY01vb2RNZXJnZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhdGljIE1vb2QgTWVyZ2UgLSBVbml0IFRlc3RzXG4gKiBUZXN0cyBkZWR1cGxpY2F0aW9uIGxvZ2ljIGFuZCBkZWxldGlvbiBjYWNoZSBpbnRlZ3JhdGlvblxuICovXG5cbmltcG9ydCB7IGludGVsbGlnZW50TW9vZE1lcmdlIH0gZnJvbSAnQC9zZXJ2aWNlcy9zdGF0aWNNb29kTWVyZ2UnO1xuaW1wb3J0IHsgbW9vZERlbGV0aW9uQ2FjaGUgfSBmcm9tICdAL3NlcnZpY2VzL21vb2REZWxldGlvbkNhY2hlJztcbmltcG9ydCB0eXBlIHsgTW9vZEVudHJ5IH0gZnJvbSAnQC9zZXJ2aWNlcy9tb29kVHJhY2tpbmdTZXJ2aWNlJztcblxuLy8gTW9jayBkZWxldGlvbiBjYWNoZVxuamVzdC5tb2NrKCdAL3NlcnZpY2VzL21vb2REZWxldGlvbkNhY2hlJyk7XG5cbmRlc2NyaWJlKCdTdGF0aWMgTW9vZCBNZXJnZSAtIFAwIERlZHVwbGljYXRpb24gRml4ZXMnLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tVc2VySWQgPSAndGVzdC11c2VyLTEyMyc7XG4gIFxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICAobW9vZERlbGV0aW9uQ2FjaGUuZ2V0UmVjZW50bHlEZWxldGVkSWRzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udGVudCBIYXNoIERlZHVwbGljYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZWR1cGxpY2F0ZSBlbnRyaWVzIHdpdGggc2FtZSBjb250ZW50X2hhc2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2NhbEVudHJ5OiBNb29kRW50cnkgPSB7XG4gICAgICAgIGlkOiAnbW9vZF9sb2NhbF8xMjMnLFxuICAgICAgICBsb2NhbF9pZDogJ21vb2RfbG9jYWxfMTIzJyxcbiAgICAgICAgY29udGVudF9oYXNoOiAnYWJjMTIzaGFzaCcsXG4gICAgICAgIHVzZXJfaWQ6IG1vY2tVc2VySWQsXG4gICAgICAgIG1vb2Rfc2NvcmU6IDc1LFxuICAgICAgICBlbmVyZ3lfbGV2ZWw6IDgwLFxuICAgICAgICBhbnhpZXR5X2xldmVsOiAzMCxcbiAgICAgICAgbm90ZXM6ICdUZXN0IGVudHJ5JyxcbiAgICAgICAgdHJpZ2dlcnM6IFtdLFxuICAgICAgICBhY3Rpdml0aWVzOiBbXSxcbiAgICAgICAgdGltZXN0YW1wOiAnMjAyNS0wOC0zMFQxMjowMDowMFonLFxuICAgICAgICBzeW5jZWQ6IGZhbHNlLFxuICAgICAgICBzeW5jX2F0dGVtcHRzOiAwXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZW1vdGVFbnRyeTogTW9vZEVudHJ5ID0ge1xuICAgICAgICBpZDogJ3V1aWQtcmVtb3RlLTQ1NicsXG4gICAgICAgIHJlbW90ZV9pZDogJ3V1aWQtcmVtb3RlLTQ1NicsXG4gICAgICAgIGNvbnRlbnRfaGFzaDogJ2FiYzEyM2hhc2gnLCAvLyBTYW1lIGNvbnRlbnQgaGFzaCFcbiAgICAgICAgdXNlcl9pZDogbW9ja1VzZXJJZCxcbiAgICAgICAgbW9vZF9zY29yZTogNzUsXG4gICAgICAgIGVuZXJneV9sZXZlbDogODAsXG4gICAgICAgIGFueGlldHlfbGV2ZWw6IDMwLFxuICAgICAgICBub3RlczogJ1Rlc3QgZW50cnknLFxuICAgICAgICB0cmlnZ2VyczogW10sXG4gICAgICAgIGFjdGl2aXRpZXM6IFtdLFxuICAgICAgICB0aW1lc3RhbXA6ICcyMDI1LTA4LTMwVDEyOjAwOjAwWicsXG4gICAgICAgIHN5bmNlZDogdHJ1ZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW50ZWxsaWdlbnRNb29kTWVyZ2UoW2xvY2FsRW50cnldLCBbcmVtb3RlRW50cnldLCBtb2NrVXNlcklkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXJnZWRFbnRyaWVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lcmdlZEVudHJpZXNbMF0uaWQpLnRvQmUoJ3V1aWQtcmVtb3RlLTQ1NicpOyAvLyBSZW1vdGUgd2luc1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0cy5kdXBsaWNhdGVzUmVtb3ZlZCkudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVkdXBsaWNhdGUgYnkgcmVtb3RlX2lkIG1hcHBpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2NhbEVudHJ5OiBNb29kRW50cnkgPSB7XG4gICAgICAgIGlkOiAnbW9vZF9sb2NhbF8xMjMnLFxuICAgICAgICBsb2NhbF9pZDogJ21vb2RfbG9jYWxfMTIzJyxcbiAgICAgICAgcmVtb3RlX2lkOiAndXVpZC1zaGFyZWQtNzg5JywgLy8gTWFwcGVkIHRvIHJlbW90ZSFcbiAgICAgICAgdXNlcl9pZDogbW9ja1VzZXJJZCxcbiAgICAgICAgbW9vZF9zY29yZTogNzUsXG4gICAgICAgIGVuZXJneV9sZXZlbDogODAsXG4gICAgICAgIGFueGlldHlfbGV2ZWw6IDMwLFxuICAgICAgICBub3RlczogJ1Rlc3QgZW50cnknLFxuICAgICAgICB0cmlnZ2VyczogW10sXG4gICAgICAgIGFjdGl2aXRpZXM6IFtdLFxuICAgICAgICB0aW1lc3RhbXA6ICcyMDI1LTA4LTMwVDEyOjAwOjAwWicsXG4gICAgICAgIHN5bmNlZDogdHJ1ZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVtb3RlRW50cnk6IE1vb2RFbnRyeSA9IHtcbiAgICAgICAgaWQ6ICd1dWlkLXNoYXJlZC03ODknLCAvLyBTYW1lIGFzIGxvY2FsJ3MgcmVtb3RlX2lkXG4gICAgICAgIHJlbW90ZV9pZDogJ3V1aWQtc2hhcmVkLTc4OScsXG4gICAgICAgIHVzZXJfaWQ6IG1vY2tVc2VySWQsXG4gICAgICAgIG1vb2Rfc2NvcmU6IDc1LFxuICAgICAgICBlbmVyZ3lfbGV2ZWw6IDgwLFxuICAgICAgICBhbnhpZXR5X2xldmVsOiAzMCxcbiAgICAgICAgbm90ZXM6ICdUZXN0IGVudHJ5JyxcbiAgICAgICAgdHJpZ2dlcnM6IFtdLFxuICAgICAgICBhY3Rpdml0aWVzOiBbXSxcbiAgICAgICAgdGltZXN0YW1wOiAnMjAyNS0wOC0zMFQxMjowMDowMFonLFxuICAgICAgICBzeW5jZWQ6IHRydWUsXG4gICAgICAgIHN5bmNfYXR0ZW1wdHM6IDBcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludGVsbGlnZW50TW9vZE1lcmdlKFtsb2NhbEVudHJ5XSwgW3JlbW90ZUVudHJ5XSwgbW9ja1VzZXJJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubWVyZ2VkRW50cmllcykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXJnZWRFbnRyaWVzWzBdLmlkKS50b0JlKCd1dWlkLXNoYXJlZC03ODknKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHMuZHVwbGljYXRlc1JlbW92ZWQpLnRvQmUoMCk7IC8vIFNraXBwZWQgdmlhIG1hcHBpbmcsIG5vdCBkdXBsaWNhdGUgcmVtb3ZhbFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGVsZXRpb24gQ2FjaGUgSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgb3V0IHJlY2VudGx5IGRlbGV0ZWQgZW50cmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbGV0ZWRJZCA9ICdkZWxldGVkLWVudHJ5LTEyMyc7XG4gICAgICAobW9vZERlbGV0aW9uQ2FjaGUuZ2V0UmVjZW50bHlEZWxldGVkSWRzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW2RlbGV0ZWRJZF0pO1xuXG4gICAgICBjb25zdCBsb2NhbEVudHJ5OiBNb29kRW50cnkgPSB7XG4gICAgICAgIGlkOiBkZWxldGVkSWQsIC8vIFRoaXMgd2FzIHJlY2VudGx5IGRlbGV0ZWRcbiAgICAgICAgdXNlcl9pZDogbW9ja1VzZXJJZCxcbiAgICAgICAgbW9vZF9zY29yZTogNTAsXG4gICAgICAgIGVuZXJneV9sZXZlbDogNTAsXG4gICAgICAgIGFueGlldHlfbGV2ZWw6IDUwLFxuICAgICAgICBub3RlczogJ1Nob3VsZCBiZSBmaWx0ZXJlZCcsXG4gICAgICAgIHRyaWdnZXJzOiBbXSxcbiAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICAgIHRpbWVzdGFtcDogJzIwMjUtMDgtMzBUMTI6MDA6MDBaJyxcbiAgICAgICAgc3luY2VkOiBmYWxzZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVtb3RlRW50cnk6IE1vb2RFbnRyeSA9IHtcbiAgICAgICAgaWQ6IGRlbGV0ZWRJZCwgLy8gU2FtZSBkZWxldGVkIElEXG4gICAgICAgIHVzZXJfaWQ6IG1vY2tVc2VySWQsXG4gICAgICAgIG1vb2Rfc2NvcmU6IDUwLFxuICAgICAgICBlbmVyZ3lfbGV2ZWw6IDUwLFxuICAgICAgICBhbnhpZXR5X2xldmVsOiA1MCxcbiAgICAgICAgbm90ZXM6ICdTaG91bGQgYmUgZmlsdGVyZWQnLFxuICAgICAgICB0cmlnZ2VyczogW10sXG4gICAgICAgIGFjdGl2aXRpZXM6IFtdLFxuICAgICAgICB0aW1lc3RhbXA6ICcyMDI1LTA4LTMwVDEyOjAwOjAwWicsXG4gICAgICAgIHN5bmNlZDogdHJ1ZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW50ZWxsaWdlbnRNb29kTWVyZ2UoW2xvY2FsRW50cnldLCBbcmVtb3RlRW50cnldLCBtb2NrVXNlcklkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXJnZWRFbnRyaWVzKS50b0hhdmVMZW5ndGgoMCk7IC8vIEJvdGggZmlsdGVyZWQgb3V0XG4gICAgICBleHBlY3QobW9vZERlbGV0aW9uQ2FjaGUuZ2V0UmVjZW50bHlEZWxldGVkSWRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlcklkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIGJ5IGxvY2FsX2lkIGFuZCByZW1vdGVfaWQgbWFwcGluZ3MgaW4gZGVsZXRpb24gY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxldGVkTG9jYWxJZCA9ICdtb29kX2RlbGV0ZWRfNDU2JztcbiAgICAgIChtb29kRGVsZXRpb25DYWNoZS5nZXRSZWNlbnRseURlbGV0ZWRJZHMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbZGVsZXRlZExvY2FsSWRdKTtcblxuICAgICAgY29uc3QgbG9jYWxFbnRyeTogTW9vZEVudHJ5ID0ge1xuICAgICAgICBpZDogJ3NvbWUtb3RoZXItaWQnLFxuICAgICAgICBsb2NhbF9pZDogZGVsZXRlZExvY2FsSWQsIC8vIFRoaXMgbG9jYWxfaWQgd2FzIGRlbGV0ZWRcbiAgICAgICAgdXNlcl9pZDogbW9ja1VzZXJJZCxcbiAgICAgICAgbW9vZF9zY29yZTogNjAsXG4gICAgICAgIGVuZXJneV9sZXZlbDogNjAsXG4gICAgICAgIGFueGlldHlfbGV2ZWw6IDQwLFxuICAgICAgICBub3RlczogJ1Nob3VsZCBiZSBmaWx0ZXJlZCBieSBsb2NhbF9pZCcsXG4gICAgICAgIHRyaWdnZXJzOiBbXSxcbiAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICAgIHRpbWVzdGFtcDogJzIwMjUtMDgtMzBUMTI6MDA6MDBaJyxcbiAgICAgICAgc3luY2VkOiBmYWxzZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW50ZWxsaWdlbnRNb29kTWVyZ2UoW2xvY2FsRW50cnldLCBbXSwgbW9ja1VzZXJJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubWVyZ2VkRW50cmllcykudG9IYXZlTGVuZ3RoKDApOyAvLyBGaWx0ZXJlZCBieSBsb2NhbF9pZCBtYXRjaFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbnRyaWVzIHdpdGhvdXQgY29udGVudF9oYXNoIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbnRyeVdpdGhvdXRIYXNoOiBNb29kRW50cnkgPSB7XG4gICAgICAgIGlkOiAnbm8taGFzaC1lbnRyeScsXG4gICAgICAgIHVzZXJfaWQ6IG1vY2tVc2VySWQsXG4gICAgICAgIG1vb2Rfc2NvcmU6IDcwLFxuICAgICAgICBlbmVyZ3lfbGV2ZWw6IDcwLFxuICAgICAgICBhbnhpZXR5X2xldmVsOiAyMCxcbiAgICAgICAgbm90ZXM6ICdObyBjb250ZW50IGhhc2gnLFxuICAgICAgICB0cmlnZ2VyczogWyd3b3JrJ10sXG4gICAgICAgIGFjdGl2aXRpZXM6IFsnZXhlcmNpc2UnXSxcbiAgICAgICAgdGltZXN0YW1wOiAnMjAyNS0wOC0zMFQxNDowMDowMFonLFxuICAgICAgICBzeW5jZWQ6IGZhbHNlLFxuICAgICAgICBzeW5jX2F0dGVtcHRzOiAwXG4gICAgICAgIC8vIGNvbnRlbnRfaGFzaCBtaXNzaW5nXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnRlbGxpZ2VudE1vb2RNZXJnZShbZW50cnlXaXRob3V0SGFzaF0sIFtdLCBtb2NrVXNlcklkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXJnZWRFbnRyaWVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lcmdlZEVudHJpZXNbMF0uaWQpLnRvQmUoJ25vLWhhc2gtZW50cnknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgdXNlcklkIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbnRyeTogTW9vZEVudHJ5ID0ge1xuICAgICAgICBpZDogJ3Rlc3QtZW50cnknLFxuICAgICAgICB1c2VyX2lkOiBtb2NrVXNlcklkLFxuICAgICAgICBtb29kX3Njb3JlOiA4MCxcbiAgICAgICAgZW5lcmd5X2xldmVsOiA3NSxcbiAgICAgICAgYW54aWV0eV9sZXZlbDogMjUsXG4gICAgICAgIG5vdGVzOiAnVGVzdCB3aXRob3V0IHVzZXJJZCcsXG4gICAgICAgIHRyaWdnZXJzOiBbXSxcbiAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICAgIHRpbWVzdGFtcDogJzIwMjUtMDgtMzBUMTU6MDA6MDBaJyxcbiAgICAgICAgc3luY2VkOiBmYWxzZSxcbiAgICAgICAgc3luY19hdHRlbXB0czogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW50ZWxsaWdlbnRNb29kTWVyZ2UoW2VudHJ5XSwgW10sIHVuZGVmaW5lZCk7IC8vIE5vIHVzZXJJZFxuXG4gICAgICBleHBlY3QocmVzdWx0Lm1lcmdlZEVudHJpZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChtb29kRGVsZXRpb25DYWNoZS5nZXRSZWNlbnRseURlbGV0ZWRJZHMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQVVBQSxXQUFBLEdBQUtDLElBQUksbUNBQStCLENBQUM7QUFBQyxJQUFBQyxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsa0JBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUwxQyxJQUFBRSxnQkFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsa0JBQUEsR0FBQUgsT0FBQTtBQUFpRSxTQUFBSCxZQUFBO0VBQUEsSUFBQU8sUUFBQSxHQUFBSixPQUFBO0lBQUFLLElBQUEsR0FBQUQsUUFBQSxDQUFBQyxJQUFBO0VBQUFSLFdBQUEsWUFBQUEsWUFBQTtJQUFBLE9BQUFRLElBQUE7RUFBQTtFQUFBLE9BQUFBLElBQUE7QUFBQTtBQU1qRUMsUUFBUSxDQUFDLDRDQUE0QyxFQUFFLFlBQU07RUFDM0QsSUFBTUMsVUFBVSxHQUFHLGVBQWU7RUFFbENDLFVBQVUsQ0FBQyxZQUFNO0lBQ2ZILElBQUksQ0FBQ0ksYUFBYSxDQUFDLENBQUM7SUFDbkJDLG9DQUFpQixDQUFDQyxxQkFBcUIsQ0FBZUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO0VBQzlFLENBQUMs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