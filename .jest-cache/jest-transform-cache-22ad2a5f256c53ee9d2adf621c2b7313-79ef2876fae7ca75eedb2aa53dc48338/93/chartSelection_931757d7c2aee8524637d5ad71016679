e324dcc9724ce1ebfaae8e5126ab23a1
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.emitSelectionHelper = emitSelectionHelper;
exports.formatXLabel = formatXLabel;
exports.getXLabelVisibility = getXLabelVisibility;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _lastKey = null;
var _lastResult = null;
function formatXLabel(item, timeRange, locale) {
  var key = `${timeRange}|${item.date}|${item.label || ''}|${locale}`;
  if (_lastKey === key && _lastResult) return _lastResult;
  var result = '';
  if (timeRange === 'day') {
    var k = item.date || '';
    var hh = k.includes('#') ? k.split('#')[1] : '00';
    var h = parseInt(hh, 10) || 0;
    result = String(h).padStart(2, '0');
  } else if (timeRange === 'week') {
    var d = new Date(`${item.date}T00:00:00`);
    var daysShort = ['Pz', 'Pt', 'Sa', 'Ça', 'Pe', 'Cu', 'Ct'];
    result = daysShort[d.getDay()];
  } else if (timeRange === 'month') {
    var label = item.label || '';
    var match = label.match(/^(\d+)/);
    if (match) result = match[1];else {
      var _d = new Date(item.date);
      result = _d.getDate().toString();
    }
  } else {
    var _d2 = new Date(item.date);
    result = new Intl.DateTimeFormat(locale, {
      month: 'short'
    }).format(_d2);
  }
  _lastKey = key;
  _lastResult = result;
  return result;
}
function getXLabelVisibility(index, total, timeRange, contentWidth) {
  if (timeRange === 'day') {
    var dw = contentWidth / Math.max(1, total);
    var _step = 1;
    if (dw < 12) _step = 4;else if (dw < 18) _step = 3;else if (dw < 28) _step = 2;else _step = 1;
    return index % _step === 0;
  }
  var minLabelPx = timeRange === 'week' ? 18 : timeRange === 'month' ? 22 : timeRange === '6months' ? 28 : 36;
  var step = Math.max(1, Math.ceil(total * minLabelPx / Math.max(1, contentWidth)));
  if (index === 0 || index === total - 1) return true;
  return index % step === 0;
}
function emitSelectionHelper(args) {
  var _data$aggregated;
  var data = args.data,
    timeRange = args.timeRange,
    contentWidth = args.contentWidth,
    chartWidth = args.chartWidth,
    dayWindowStart = args.dayWindowStart,
    dayWindowSize = args.dayWindowSize,
    index = args.index,
    locale = args.locale,
    AXIS_WIDTH = args.AXIS_WIDTH,
    onSelectionChange = args.onSelectionChange;
  var items = timeRange === 'day' ? (data.hourlyAverages || []).slice(dayWindowStart, dayWindowStart + dayWindowSize).map(function (h) {
    return {
      date: h.dateKey
    };
  }) : ((_data$aggregated = data.aggregated) == null ? void 0 : _data$aggregated.data) || [];
  var n = items.length;
  if (index === null || index < 0 || index > n - 1) {
    onSelectionChange == null || onSelectionChange(null);
    return;
  }
  var totalCount = 0;
  var hasData = false;
  if (timeRange === 'day') {
    var _rawHourlyDataPoints;
    var hourItem = items[index];
    var rp = ((_rawHourlyDataPoints = data.rawHourlyDataPoints) == null || (_rawHourlyDataPoints = _rawHourlyDataPoints[hourItem.date]) == null ? void 0 : _rawHourlyDataPoints.entries) || [];
    totalCount = rp.length;
    hasData = totalCount > 0;
  } else {
    var b = items[index];
    totalCount = Number(b.count || 0);
    hasData = totalCount > 0;
  }
  if (!hasData || totalCount === 0) {
    var found = -1;
    for (var step = 1; step < n; step++) {
      var left = index - step;
      var right = index + step;
      var check = function check(k) {
        if (k < 0 || k >= n) return false;
        if (timeRange === 'day') {
          var _rawHourlyDataPoints2;
          var it = items[k];
          var _rp = ((_rawHourlyDataPoints2 = data.rawHourlyDataPoints) == null || (_rawHourlyDataPoints2 = _rawHourlyDataPoints2[it.date]) == null ? void 0 : _rawHourlyDataPoints2.entries) || [];
          return _rp.length > 0;
        } else {
          return Number(items[k].count || 0) > 0;
        }
      };
      if (check(left)) {
        found = left;
        break;
      }
      if (check(right)) {
        found = right;
        break;
      }
    }
    if (found === -1) {
      onSelectionChange == null || onSelectionChange(null);
      return;
    }
    return emitSelectionHelper(Object.assign({}, args, {
      index: found
    }));
  }
  var dw = contentWidth / Math.max(1, n);
  var x = AXIS_WIDTH + index * dw + dw / 2;
  var labelText = '';
  var dateSel = '';
  if (timeRange === 'day') {
    var it = items[index];
    var _String$split = String(it.date).split('#'),
      _String$split2 = (0, _slicedToArray2.default)(_String$split, 2),
      dstr = _String$split2[0],
      hh = _String$split2[1];
    var d = new Date(`${dstr}T00:00:00.000Z`);
    var h = parseInt(hh || '0', 10);
    var mon = new Intl.DateTimeFormat(locale, {
      month: 'short'
    }).format(d);
    var day = d.getDate();
    var year = d.getFullYear();
    labelText = `${day} ${mon} ${year} • ${String(h).padStart(2, '0')}:00`;
    dateSel = it.date;
  } else {
    var _b = items[index];
    if (timeRange === 'week') {
      var _d3 = new Date(`${_b.date}T00:00:00.000Z`);
      var monthsLongShort = ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara'];
      labelText = `${_d3.getDate()} ${monthsLongShort[_d3.getMonth()]} ${_d3.getFullYear()}`;
    } else {
      labelText = _b.label || '';
    }
    dateSel = _b.date;
  }
  onSelectionChange == null || onSelectionChange({
    date: dateSel,
    index: index,
    totalCount: totalCount,
    label: labelText,
    x: x,
    chartWidth: chartWidth,
    bucketCount: n
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbGFzdEtleSIsIl9sYXN0UmVzdWx0IiwiZm9ybWF0WExhYmVsIiwiaXRlbSIsInRpbWVSYW5nZSIsImxvY2FsZSIsImtleSIsImRhdGUiLCJsYWJlbCIsInJlc3VsdCIsImsiLCJoaCIsImluY2x1ZGVzIiwic3BsaXQiLCJoIiwicGFyc2VJbnQiLCJTdHJpbmciLCJwYWRTdGFydCIsImQiLCJEYXRlIiwiZGF5c1Nob3J0IiwiZ2V0RGF5IiwibWF0Y2giLCJnZXREYXRlIiwidG9TdHJpbmciLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJtb250aCIsImZvcm1hdCIsImdldFhMYWJlbFZpc2liaWxpdHkiLCJpbmRleCIsInRvdGFsIiwiY29udGVudFdpZHRoIiwiZHciLCJNYXRoIiwibWF4Iiwic3RlcCIsIm1pbkxhYmVsUHgiLCJjZWlsIiwiZW1pdFNlbGVjdGlvbkhlbHBlciIsImFyZ3MiLCJfZGF0YSRhZ2dyZWdhdGVkIiwiZGF0YSIsImNoYXJ0V2lkdGgiLCJkYXlXaW5kb3dTdGFydCIsImRheVdpbmRvd1NpemUiLCJBWElTX1dJRFRIIiwib25TZWxlY3Rpb25DaGFuZ2UiLCJpdGVtcyIsImhvdXJseUF2ZXJhZ2VzIiwic2xpY2UiLCJtYXAiLCJkYXRlS2V5IiwiYWdncmVnYXRlZCIsIm4iLCJsZW5ndGgiLCJ0b3RhbENvdW50IiwiaGFzRGF0YSIsIl9yYXdIb3VybHlEYXRhUG9pbnRzIiwiaG91ckl0ZW0iLCJycCIsInJhd0hvdXJseURhdGFQb2ludHMiLCJlbnRyaWVzIiwiYiIsIk51bWJlciIsImNvdW50IiwiZm91bmQiLCJsZWZ0IiwicmlnaHQiLCJjaGVjayIsIl9yYXdIb3VybHlEYXRhUG9pbnRzMiIsIml0IiwiT2JqZWN0IiwiYXNzaWduIiwieCIsImxhYmVsVGV4dCIsImRhdGVTZWwiLCJfU3RyaW5nJHNwbGl0IiwiX1N0cmluZyRzcGxpdDIiLCJfc2xpY2VkVG9BcnJheTIiLCJkZWZhdWx0IiwiZHN0ciIsIm1vbiIsImRheSIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoc0xvbmdTaG9ydCIsImdldE1vbnRoIiwiYnVja2V0Q291bnQiXSwic291cmNlcyI6WyJjaGFydFNlbGVjdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFRpbWVSYW5nZSwgRGFpbHlBdmVyYWdlLCBBZ2dyZWdhdGVkRGF0YSwgTW9vZEpvdXJuZXlFeHRlbmRlZCB9IGZyb20gJ0AvdHlwZXMvbW9vZCc7XG5cbmV4cG9ydCB0eXBlIFNlbGVjdGlvblBheWxvYWQgPSB7XG4gIGRhdGU6IHN0cmluZztcbiAgaW5kZXg6IG51bWJlcjtcbiAgdG90YWxDb3VudDogbnVtYmVyO1xuICBsYWJlbDogc3RyaW5nO1xuICB4OiBudW1iZXI7XG4gIGNoYXJ0V2lkdGg6IG51bWJlcjtcbiAgYnVja2V0Q291bnQ6IG51bWJlcjtcbn0gfCBudWxsO1xuXG4vLyBTaW1wbGUgb25lLWl0ZW0gbWVtb2l6YXRpb24gZm9yIGZvcm1hdFhMYWJlbFxubGV0IF9sYXN0S2V5OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbmxldCBfbGFzdFJlc3VsdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRYTGFiZWwoaXRlbTogRGFpbHlBdmVyYWdlIHwgQWdncmVnYXRlZERhdGEsIHRpbWVSYW5nZTogVGltZVJhbmdlLCBsb2NhbGU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGtleSA9IGAke3RpbWVSYW5nZX18JHsoaXRlbSBhcyBhbnkpLmRhdGV9fCR7KGl0ZW0gYXMgYW55KS5sYWJlbCB8fCAnJ318JHtsb2NhbGV9YDtcbiAgaWYgKF9sYXN0S2V5ID09PSBrZXkgJiYgX2xhc3RSZXN1bHQpIHJldHVybiBfbGFzdFJlc3VsdDtcblxuICBsZXQgcmVzdWx0ID0gJyc7XG4gIGlmICh0aW1lUmFuZ2UgPT09ICdkYXknKSB7XG4gICAgY29uc3QgayA9ICgoaXRlbSBhcyBhbnkpLmRhdGUgfHwgJycpIGFzIHN0cmluZzsgLy8gWVlZWS1NTS1ERCNISFxuICAgIGNvbnN0IGhoID0gay5pbmNsdWRlcygnIycpID8gay5zcGxpdCgnIycpWzFdIDogJzAwJztcbiAgICBjb25zdCBoID0gcGFyc2VJbnQoaGgsIDEwKSB8fCAwO1xuICAgIHJlc3VsdCA9IFN0cmluZyhoKS5wYWRTdGFydCgyLCAnMCcpO1xuICB9IGVsc2UgaWYgKHRpbWVSYW5nZSA9PT0gJ3dlZWsnKSB7XG4gICAgLy8gUGFyc2UgWVlZWS1NTS1ERCBleHBsaWNpdGx5IGFzIGxvY2FsIG1pZG5pZ2h0XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGAkeyhpdGVtIGFzIERhaWx5QXZlcmFnZSkuZGF0ZX1UMDA6MDA6MDBgKTtcbiAgICBjb25zdCBkYXlzU2hvcnQgPSBbJ1B6JywgJ1B0JywgJ1NhJywgJ8OHYScsICdQZScsICdDdScsICdDdCddO1xuICAgIHJlc3VsdCA9IGRheXNTaG9ydFtkLmdldERheSgpXTtcbiAgfSBlbHNlIGlmICh0aW1lUmFuZ2UgPT09ICdtb250aCcpIHtcbiAgICBjb25zdCBsYWJlbCA9IChpdGVtIGFzIEFnZ3JlZ2F0ZWREYXRhKS5sYWJlbCB8fCAnJztcbiAgICBjb25zdCBtYXRjaCA9IGxhYmVsLm1hdGNoKC9eKFxcZCspLyk7XG4gICAgaWYgKG1hdGNoKSByZXN1bHQgPSBtYXRjaFsxXTtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgoaXRlbSBhcyBBZ2dyZWdhdGVkRGF0YSkuZGF0ZSk7XG4gICAgICByZXN1bHQgPSBkLmdldERhdGUoKS50b1N0cmluZygpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoKGl0ZW0gYXMgQWdncmVnYXRlZERhdGEpLmRhdGUpO1xuICAgIHJlc3VsdCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyBtb250aDogJ3Nob3J0JyB9KS5mb3JtYXQoZCk7XG4gIH1cbiAgX2xhc3RLZXkgPSBrZXk7XG4gIF9sYXN0UmVzdWx0ID0gcmVzdWx0O1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0WExhYmVsVmlzaWJpbGl0eShpbmRleDogbnVtYmVyLCB0b3RhbDogbnVtYmVyLCB0aW1lUmFuZ2U6IFRpbWVSYW5nZSwgY29udGVudFdpZHRoOiBudW1iZXIpOiBib29sZWFuIHtcbiAgaWYgKHRpbWVSYW5nZSA9PT0gJ2RheScpIHtcbiAgICBjb25zdCBkdyA9IGNvbnRlbnRXaWR0aCAvIE1hdGgubWF4KDEsIHRvdGFsKTtcbiAgICBsZXQgc3RlcCA9IDE7XG4gICAgaWYgKGR3IDwgMTIpIHN0ZXAgPSA0OyAvLyAwLDQsOCwxMiwxNiwyMFxuICAgIGVsc2UgaWYgKGR3IDwgMTgpIHN0ZXAgPSAzOyAvLyAwLDMsNiw5LDEyLDE1LDE4LDIxXG4gICAgZWxzZSBpZiAoZHcgPCAyOCkgc3RlcCA9IDI7IC8vIDAsMiw0Li4uXG4gICAgZWxzZSBzdGVwID0gMTsgLy8gaGVyIHNhYXRcbiAgICByZXR1cm4gaW5kZXggJSBzdGVwID09PSAwO1xuICB9XG4gIGNvbnN0IG1pbkxhYmVsUHggPSAodGltZVJhbmdlID09PSAnd2VlaycpID8gMTggOiAodGltZVJhbmdlID09PSAnbW9udGgnKSA/IDIyIDogKHRpbWVSYW5nZSA9PT0gJzZtb250aHMnKSA/IDI4IDogMzY7IC8vIHllYXJcbiAgY29uc3Qgc3RlcCA9IE1hdGgubWF4KDEsIE1hdGguY2VpbCgodG90YWwgKiBtaW5MYWJlbFB4KSAvIE1hdGgubWF4KDEsIGNvbnRlbnRXaWR0aCkpKTtcbiAgaWYgKGluZGV4ID09PSAwIHx8IGluZGV4ID09PSB0b3RhbCAtIDEpIHJldHVybiB0cnVlO1xuICByZXR1cm4gaW5kZXggJSBzdGVwID09PSAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1pdFNlbGVjdGlvbkhlbHBlcihhcmdzOiB7XG4gIGRhdGE6IE1vb2RKb3VybmV5RXh0ZW5kZWQ7XG4gIHRpbWVSYW5nZTogVGltZVJhbmdlO1xuICBjb250ZW50V2lkdGg6IG51bWJlcjtcbiAgY2hhcnRXaWR0aDogbnVtYmVyO1xuICBkYXlXaW5kb3dTdGFydDogbnVtYmVyO1xuICBkYXlXaW5kb3dTaXplOiBudW1iZXI7XG4gIGluZGV4OiBudW1iZXIgfCBudWxsO1xuICBsb2NhbGU6IHN0cmluZztcbiAgQVhJU19XSURUSDogbnVtYmVyO1xuICBvblNlbGVjdGlvbkNoYW5nZT86IChwYXlsb2FkOiBTZWxlY3Rpb25QYXlsb2FkKSA9PiB2b2lkO1xufSk6IHZvaWQge1xuICBjb25zdCB7IGRhdGEsIHRpbWVSYW5nZSwgY29udGVudFdpZHRoLCBjaGFydFdpZHRoLCBkYXlXaW5kb3dTdGFydCwgZGF5V2luZG93U2l6ZSwgaW5kZXgsIGxvY2FsZSwgQVhJU19XSURUSCwgb25TZWxlY3Rpb25DaGFuZ2UgfSA9IGFyZ3M7XG4gIGNvbnN0IGl0ZW1zID0gKHRpbWVSYW5nZSA9PT0gJ2RheScpXG4gICAgPyAoKChkYXRhLmhvdXJseUF2ZXJhZ2VzIHx8IFtdKVxuICAgICAgICAuc2xpY2UoZGF5V2luZG93U3RhcnQsIGRheVdpbmRvd1N0YXJ0ICsgZGF5V2luZG93U2l6ZSlcbiAgICAgICAgLm1hcCgoaDogYW55KSA9PiAoeyBkYXRlOiBoLmRhdGVLZXkgfSkpICkgYXMgYW55W10pXG4gICAgOiAoZGF0YS5hZ2dyZWdhdGVkPy5kYXRhIHx8IFtdKTtcbiAgY29uc3QgbiA9IGl0ZW1zLmxlbmd0aDtcbiAgaWYgKGluZGV4ID09PSBudWxsIHx8IGluZGV4IDwgMCB8fCBpbmRleCA+IG4gLSAxKSB7XG4gICAgb25TZWxlY3Rpb25DaGFuZ2U/LihudWxsKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgdG90YWxDb3VudCA9IDA7XG4gIGxldCBoYXNEYXRhID0gZmFsc2U7XG4gIGlmICh0aW1lUmFuZ2UgPT09ICdkYXknKSB7XG4gICAgY29uc3QgaG91ckl0ZW0gPSBpdGVtc1tpbmRleF0gYXMgYW55OyAvLyB7IGRhdGU6IFlZWVktTU0tREQjSEggfVxuICAgIGNvbnN0IHJwID0gKGRhdGEgYXMgYW55KS5yYXdIb3VybHlEYXRhUG9pbnRzPy5baG91ckl0ZW0uZGF0ZV0/LmVudHJpZXMgfHwgW107XG4gICAgdG90YWxDb3VudCA9IHJwLmxlbmd0aDtcbiAgICBoYXNEYXRhID0gdG90YWxDb3VudCA+IDA7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYiA9IGl0ZW1zW2luZGV4XSBhcyBBZ2dyZWdhdGVkRGF0YTtcbiAgICB0b3RhbENvdW50ID0gTnVtYmVyKGIuY291bnQgfHwgMCk7XG4gICAgaGFzRGF0YSA9IHRvdGFsQ291bnQgPiAwO1xuICB9XG5cbiAgaWYgKCFoYXNEYXRhIHx8IHRvdGFsQ291bnQgPT09IDApIHtcbiAgICBsZXQgZm91bmQgPSAtMTtcbiAgICBmb3IgKGxldCBzdGVwID0gMTsgc3RlcCA8IG47IHN0ZXArKykge1xuICAgICAgY29uc3QgbGVmdCA9IGluZGV4IC0gc3RlcDtcbiAgICAgIGNvbnN0IHJpZ2h0ID0gaW5kZXggKyBzdGVwO1xuICAgICAgY29uc3QgY2hlY2sgPSAoazogbnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChrIDwgMCB8fCBrID49IG4pIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRpbWVSYW5nZSA9PT0gJ2RheScpIHtcbiAgICAgICAgICBjb25zdCBpdDogYW55ID0gaXRlbXNba107XG4gICAgICAgICAgY29uc3QgcnAgPSAoZGF0YSBhcyBhbnkpLnJhd0hvdXJseURhdGFQb2ludHM/LltpdC5kYXRlXT8uZW50cmllcyB8fCBbXTtcbiAgICAgICAgICByZXR1cm4gcnAubGVuZ3RoID4gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKChpdGVtc1trXSBhcyBhbnkpLmNvdW50IHx8IDApID4gMDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmIChjaGVjayhsZWZ0KSkgeyBmb3VuZCA9IGxlZnQ7IGJyZWFrOyB9XG4gICAgICBpZiAoY2hlY2socmlnaHQpKSB7IGZvdW5kID0gcmlnaHQ7IGJyZWFrOyB9XG4gICAgfVxuICAgIGlmIChmb3VuZCA9PT0gLTEpIHsgb25TZWxlY3Rpb25DaGFuZ2U/LihudWxsKTsgcmV0dXJuOyB9XG4gICAgLy8gUmVrw7xyc2lmIMOnYcSfcsSxIHllcmluZSBkb8SfcnVkYW4gcGF5bG9hZCDDvHJldGVsaW1cbiAgICByZXR1cm4gZW1pdFNlbGVjdGlvbkhlbHBlcih7IC4uLmFyZ3MsIGluZGV4OiBmb3VuZCB9KTtcbiAgfVxuXG4gIGNvbnN0IGR3ID0gY29udGVudFdpZHRoIC8gTWF0aC5tYXgoMSwgbik7XG4gIGNvbnN0IHggPSBBWElTX1dJRFRIICsgKGluZGV4ICogZHcpICsgKGR3IC8gMik7XG4gIGxldCBsYWJlbFRleHQgPSAnJztcbiAgbGV0IGRhdGVTZWwgPSAnJztcblxuICBpZiAodGltZVJhbmdlID09PSAnZGF5Jykge1xuICAgIGNvbnN0IGl0ID0gaXRlbXNbaW5kZXhdIGFzIGFueTsgLy8geyBkYXRlOiBZWVlZLU1NLUREI0hIIH1cbiAgICBjb25zdCBbZHN0ciwgaGhdID0gU3RyaW5nKGl0LmRhdGUpLnNwbGl0KCcjJyk7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGAke2RzdHJ9VDAwOjAwOjAwLjAwMFpgKTtcbiAgICBjb25zdCBoID0gcGFyc2VJbnQoaGggfHwgJzAnLCAxMCk7XG4gICAgY29uc3QgbW9uID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChkKTtcbiAgICBjb25zdCBkYXkgPSBkLmdldERhdGUoKTtcbiAgICBjb25zdCB5ZWFyID0gZC5nZXRGdWxsWWVhcigpO1xuICAgIGxhYmVsVGV4dCA9IGAke2RheX0gJHttb259ICR7eWVhcn0g4oCiICR7U3RyaW5nKGgpLnBhZFN0YXJ0KDIsICcwJyl9OjAwYDtcbiAgICBkYXRlU2VsID0gaXQuZGF0ZTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBiID0gaXRlbXNbaW5kZXhdIGFzIEFnZ3JlZ2F0ZWREYXRhO1xuICAgIGlmICh0aW1lUmFuZ2UgPT09ICd3ZWVrJykge1xuICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKGAke2IuZGF0ZX1UMDA6MDA6MDAuMDAwWmApO1xuICAgICAgY29uc3QgbW9udGhzTG9uZ1Nob3J0ID0gWydPY2EnLCfFnnViJywnTWFyJywnTmlzJywnTWF5JywnSGF6JywnVGVtJywnQcSfdScsJ0V5bCcsJ0VraScsJ0thcycsJ0FyYSddO1xuICAgICAgbGFiZWxUZXh0ID0gYCR7ZC5nZXREYXRlKCl9ICR7bW9udGhzTG9uZ1Nob3J0W2QuZ2V0TW9udGgoKV19ICR7ZC5nZXRGdWxsWWVhcigpfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxhYmVsVGV4dCA9IChiIGFzIGFueSkubGFiZWwgfHwgJyc7XG4gICAgfVxuICAgIGRhdGVTZWwgPSBiLmRhdGU7XG4gIH1cblxuICBvblNlbGVjdGlvbkNoYW5nZT8uKHsgZGF0ZTogZGF0ZVNlbCwgaW5kZXgsIHRvdGFsQ291bnQsIGxhYmVsOiBsYWJlbFRleHQsIHgsIGNoYXJ0V2lkdGgsIGJ1Y2tldENvdW50OiBuIH0pO1xufVxuXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBYUEsSUFBSUEsUUFBdUIsR0FBRyxJQUFJO0FBQ2xDLElBQUlDLFdBQTBCLEdBQUcsSUFBSTtBQUU5QixTQUFTQyxZQUFZQSxDQUFDQyxJQUFtQyxFQUFFQyxTQUFvQixFQUFFQyxNQUFjLEVBQVU7RUFDOUcsSUFBTUMsR0FBRyxHQUFHLEdBQUdGLFNBQVMsSUFBS0QsSUFBSSxDQUFTSSxJQUFJLElBQUtKLElBQUksQ0FBU0ssS0FBSyxJQUFJLEVBQUUsSUFBSUgsTUFBTSxFQUFFO0VBQ3ZGLElBQUlMLFFBQVEsS0FBS00sR0FBRyxJQUFJTCxXQUFXLEVBQUUsT0FBT0EsV0FBVztFQUV2RCxJQUFJUSxNQUFNLEdBQUcsRUFBRTtFQUNmLElBQUlMLFNBQVMsS0FBSyxLQUFLLEVBQUU7SUFDdkIsSUFBTU0sQ0FBQyxHQUFLUCxJQUFJLENBQVNJLElBQUksSUFBSSxFQUFhO0lBQzlDLElBQU1JLEVBQUUsR0FBR0QsQ0FBQyxDQUFD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