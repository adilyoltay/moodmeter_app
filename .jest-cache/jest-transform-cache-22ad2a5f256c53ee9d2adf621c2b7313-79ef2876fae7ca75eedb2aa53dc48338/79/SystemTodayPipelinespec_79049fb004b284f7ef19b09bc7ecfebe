f44b81753e9835f47560adf3be45102e
_getJestObj().mock("../../services/supabase", function () {
  return {
    __esModule: true,
    default: {
      supabaseClient: {
        from: jest.fn(function () {
          return {
            select: jest.fn(function () {
              return {
                eq: jest.fn(function () {
                  return {
                    maybeSingle: jest.fn((0, _asyncToGenerator2.default)(function* () {
                      return {
                        data: null,
                        error: null
                      };
                    }))
                  };
                })
              };
            }),
            upsert: jest.fn((0, _asyncToGenerator2.default)(function* () {
              return {
                data: null,
                error: null
              };
            })),
            delete: jest.fn(function () {
              return {
                eq: jest.fn((0, _asyncToGenerator2.default)(function* () {
                  return {
                    data: null,
                    error: null
                  };
                }))
              };
            }),
            like: jest.fn(function () {
              return {
                delete: jest.fn(function () {
                  return {
                    eq: jest.fn((0, _asyncToGenerator2.default)(function* () {
                      return {
                        data: null,
                        error: null
                      };
                    }))
                  };
                })
              };
            }),
            eq: jest.fn(function () {
              return {
                maybeSingle: jest.fn((0, _asyncToGenerator2.default)(function* () {
                  return {
                    data: null,
                    error: null
                  };
                }))
              };
            })
          };
        })
      }
    }
  };
});
_getJestObj().mock("../../features/ai/telemetry/aiTelemetry", function () {
  var actual = jest.requireActual("../../features/ai/telemetry/aiTelemetry");
  return Object.assign({
    __esModule: true
  }, actual, {
    trackAIInteraction: jest.fn((0, _asyncToGenerator2.default)(function* () {}))
  });
});
_getJestObj().mock("../../hooks/useCacheInvalidation", function () {
  return {
    __esModule: true,
    emitAIInvalidation: function emitAIInvalidation() {
      return mockEmitAIInvalidation.apply(void 0, arguments);
    }
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _seedData = require("../fixtures/seedData");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
var unifiedPipeline;
var actualTelemetry = jest.requireActual("../../features/ai/telemetry/aiTelemetry");
var AIEventType = actualTelemetry.AIEventType;
var mockEmitAIInvalidation = jest.fn();
describe('System Today - Unified Pipeline', function () {
  var userId = _seedData.TEST_ENV.SEED_USER_ID;
  var trackAIInteraction;
  beforeAll(function () {
    process.env.TEST_MODE = '1';
    process.env.TEST_TTL_MS = '5000';
    process.env.TEST_PIPELINE_STUB = '0';
    process.env.TEST_SEED_USER_ID = userId;
    process.env.EXPO_PUBLIC_ENABLE_AI = 'true';
    jest.resetModules();
    unifiedPipeline = require("../../features/ai/core/UnifiedAIPipeline").unifiedPipeline;
    trackAIInteraction = require("../../features/ai/telemetry/aiTelemetry").trackAIInteraction;
  });
  beforeEach((0, _asyncToGenerator2.default)(function* () {
    jest.clearAllMocks();
    yield _asyncStorage.default.clear();
  }));
  it('[QRsys:today:fresh] processes fresh and writes unified:* cache', (0, _asyncToGenerator2.default)(function* () {
    var moodsRaw = (0, _seedData.generateMoodData)(_seedData.MOOD_SCENARIOS.high);
    var moods = moodsRaw.map(function (m) {
      return Object.assign({}, m, {
        timestamp: m.created_at,
        mood_score: m.mood_level
      });
    });
    var result = yield unifiedPipeline.process({
      userId: userId,
      type: 'data',
      content: {
        moods: moods
      },
      context: {
        source: 'mood'
      }
    });
    expect(result.metadata.source).toBe('fresh');
    var calls = trackAIInteraction.mock.calls.map(function (args) {
      return args[0];
    });
    expect(calls).toContain(AIEventType.UNIFIED_PIPELINE_STARTED);
    expect(calls).toContain(AIEventType.UNIFIED_PIPELINE_COMPLETED);
  }));
  it('[QRsys:today:cache] returns cache on subsequent run', (0, _asyncToGenerator2.default)(function* () {
    var moodsRaw = (0, _seedData.generateMoodData)(_seedData.MOOD_SCENARIOS.medium);
    var moods = moodsRaw.map(function (m) {
      return Object.assign({}, m, {
        timestamp: m.created_at,
        mood_score: m.mood_level
      });
    });
    yield unifiedPipeline.process({
      userId: userId,
      type: 'data',
      content: {
        moods: moods
      },
      context: {
        source: 'mood'
      }
    });
    var second = yield unifiedPipeline.process({
      userId: userId,
      type: 'data',
      content: {
        moods: moods
      },
      context: {
        source: 'mood'
      }
    });
    expect(second.metadata.source).toBe('cache');
    var calls = trackAIInteraction.mock.calls.map(function (args) {
      return args[0];
    });
    expect(calls).toContain(AIEventType.UNIFIED_PIPELINE_CACHE_HIT);
  }));
  it('[QRsys:today:invalidate] emits invalidation and reruns pipeline', (0, _asyncToGenerator2.default)(function* () {
    var moodsRaw = (0, _seedData.generateMoodData)(_seedData.MOOD_SCENARIOS.low);
    var moods = moodsRaw.map(function (m) {
      return Object.assign({}, m, {
        timestamp: m.created_at,
        mood_score: m.mood_level
      });
    });
    yield unifiedPipeline.process({
      userId: userId,
      type: 'data',
      content: {
        moods: moods
      },
      context: {
        source: 'mood'
      }
    });
    yield unifiedPipeline.triggerInvalidation('mood_added', userId);
    var eventTypes = trackAIInteraction.mock.calls.map(function (args) {
      return args[0];
    });
    expect(eventTypes).toContain(AIEventType.CACHE_INVALIDATION);
    yield unifiedPipeline.process({
      userId: userId,
      type: 'data',
      content: {
        moods: moods
      },
      context: {
        source: 'mood'
      }
    });
    var afterInvalidate = trackAIInteraction.mock.calls.filter(function (c) {
      return [AIEventType.UNIFIED_PIPELINE_STARTED, AIEventType.UNIFIED_PIPELINE_COMPLETED].includes(c[0]);
    }).length;
    expect(afterInvalidate).toBeGreaterThanOrEqual(2);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInN1cGFiYXNlQ2xpZW50IiwiZnJvbSIsImplc3QiLCJmbiIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkYXRhIiwiZXJyb3IiLCJ1cHNlcnQiLCJkZWxldGUiLCJsaWtlIiwiYWN0dWFsIiwicmVxdWlyZUFjdHVhbCIsIk9iamVjdCIsImFzc2lnbiIsInRyYWNrQUlJbnRlcmFjdGlvbiIsImVtaXRBSUludmFsaWRhdGlvbiIsIm1vY2tFbWl0QUlJbnZhbGlkYXRpb24iLCJhcHBseSIsImFyZ3VtZW50cyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9zZWVkRGF0YSIsIl9yZXF1aXJlIiwidW5pZmllZFBpcGVsaW5lIiwiYWN0dWFsVGVsZW1ldHJ5IiwiQUlFdmVudFR5cGUiLCJkZXNjcmliZSIsInVzZXJJZCIsIlRFU1RfRU5WIiwiU0VFRF9VU0VSX0lEIiwiYmVmb3JlQWxsIiwicHJvY2VzcyIsImVudiIsIlRFU1RfTU9ERSIsIlRFU1RfVFRMX01TIiwiVEVTVF9QSVBFTElORV9TVFVCIiwiVEVTVF9TRUVEX1VTRVJfSUQiLCJFWFBPX1BVQkxJQ19FTkFCTEVfQUkiLCJyZXNldE1vZHVsZXMiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIkFzeW5jU3RvcmFnZSIsImNsZWFyIiwiaXQiLCJtb29kc1JhdyIsImdlbmVyYXRlTW9vZERhdGEiLCJNT09EX1NDRU5BUklPUyIsImhpZ2giLCJtb29kcyIsIm1hcCIsIm0iLCJ0aW1lc3RhbXAiLCJjcmVhdGVkX2F0IiwibW9vZF9zY29yZSIsIm1vb2RfbGV2ZWwiLCJyZXN1bHQiLCJ0eXBlIiwiY29udGVudCIsImNvbnRleHQiLCJzb3VyY2UiLCJleHBlY3QiLCJtZXRhZGF0YSIsInRvQmUiLCJjYWxscyIsImFyZ3MiLCJ0b0NvbnRhaW4iLCJVTklGSUVEX1BJUEVMSU5FX1NUQVJURUQiLCJVTklGSUVEX1BJUEVMSU5FX0NPTVBMRVRFRCIsIm1lZGl1bSIsInNlY29uZCIsIlVOSUZJRURfUElQRUxJTkVfQ0FDSEVfSElUIiwibG93IiwidHJpZ2dlckludmFsaWRhdGlvbiIsImV2ZW50VHlwZXMiLCJDQUNIRV9JTlZBTElEQVRJT04iLCJhZnRlckludmFsaWRhdGUiLCJmaWx0ZXIiLCJjIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJ0b0JlR3JlYXRlclRoYW5PckVxdWFsIl0sInNvdXJjZXMiOlsiU3lzdGVtVG9kYXlQaXBlbGluZS5zcGVjLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfp6ogU3lzdGVtLU1vZGUgVGVzdHMg4oCUIFRvZGF5IChSZWFsIFVuaWZpZWRBSVBpcGVsaW5lKVxuICpcbiAqIFJ1bnMgdGhlIHJlYWwgcGlwZWxpbmUgKG5vIHN0dWJzKSB3aXRoIGRldGVybWluaXN0aWMgaW5wdXRzIGFuZCB2ZXJpZmllczpcbiAqIC0gRnJlc2ggcHJvY2Vzc2luZyBhbmQgY2FjaGUgd3JpdGVcbiAqIC0gQ2FjaGUgaGl0IG9uIHN1YnNlcXVlbnQgcnVuXG4gKiAtIEludmFsaWRhdGlvbiBlbWl0cyB0ZWxlbWV0cnkgYW5kIHJlcnVucyBwaXBlbGluZVxuICogVGFnczogW1FSc3lzOnRvZGF5OmZyZXNofGNhY2hlfGludmFsaWRhdGVdXG4gKi9cblxuaW1wb3J0IEFzeW5jU3RvcmFnZSBmcm9tICdAcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvYXN5bmMtc3RvcmFnZSc7XG4vLyB1bmlmaWVkUGlwZWxpbmUgd2lsbCBiZSByZXF1aXJlZCBhZnRlciBlbnYgaXMgc2V0XG5sZXQgdW5pZmllZFBpcGVsaW5lOiBhbnk7XG5cbi8vIFVzZSBhY3R1YWwgZW51bXMgd2hpbGUgc3B5aW5nIG9uIGZ1bmN0aW9uXG5jb25zdCBhY3R1YWxUZWxlbWV0cnkgPSBqZXN0LnJlcXVpcmVBY3R1YWwoJ0AvZmVhdHVyZXMvYWkvdGVsZW1ldHJ5L2FpVGVsZW1ldHJ5Jyk7XG5pbXBvcnQgdHlwZSB7IEFJRXZlbnRUeXBlIGFzIEFJRXZlbnRUeXBlVHlwZSB9IGZyb20gJ0AvZmVhdHVyZXMvYWkvdGVsZW1ldHJ5L2FpVGVsZW1ldHJ5JztcbmNvbnN0IEFJRXZlbnRUeXBlOiB0eXBlb2YgYWN0dWFsVGVsZW1ldHJ5LkFJRXZlbnRUeXBlID0gYWN0dWFsVGVsZW1ldHJ5LkFJRXZlbnRUeXBlO1xuXG4vLyBEZXRlcm1pbmlzdGljIHNlZWQgaGVscGVyc1xuaW1wb3J0IHtcbiAgTU9PRF9TQ0VOQVJJT1MsXG4gIGdlbmVyYXRlTW9vZERhdGEsXG4gIFRFU1RfRU5WXG59IGZyb20gJy4uL2ZpeHR1cmVzL3NlZWREYXRhJztcblxuLy8gTW9jayBTdXBhYmFzZSBzZXJ2aWNlIHRvIGF2b2lkIG5ldHdvcmsvY3JlZGVudGlhbHNcbmplc3QubW9jaygnQC9zZXJ2aWNlcy9zdXBhYmFzZScsICgpID0+ICh7XG4gIF9fZXNNb2R1bGU6IHRydWUsXG4gIGRlZmF1bHQ6IHtcbiAgICBzdXBhYmFzZUNsaWVudDoge1xuICAgICAgZnJvbTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHsgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGU6IGplc3QuZm4oYXN5bmMgKCkgPT4gKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSkpIH0pKSB9KSksXG4gICAgICAgIHVwc2VydDogamVzdC5mbihhc3luYyAoKSA9PiAoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSksXG4gICAgICAgIGRlbGV0ZTogamVzdC5mbigoKSA9PiAoeyBlcTogamVzdC5mbihhc3luYyAoKSA9PiAoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSkgfSkpLFxuICAgICAgICBsaWtlOiBqZXN0LmZuKCgpID0+ICh7IGRlbGV0ZTogamVzdC5mbigoKSA9PiAoeyBlcTogamVzdC5mbihhc3luYyAoKSA9PiAoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSkgfSkpIH0pKSxcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGU6IGplc3QuZm4oYXN5bmMgKCkgPT4gKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSkpIH0pKSxcbiAgICAgIH0pKVxuICAgIH1cbiAgfVxufSkpO1xuXG4vLyBTcHkgb24gdGVsZW1ldHJ5IHdoaWxlIGtlZXBpbmcgYWN0dWFsIGVudW1cbmplc3QubW9jaygnQC9mZWF0dXJlcy9haS90ZWxlbWV0cnkvYWlUZWxlbWV0cnknLCAoKSA9PiB7XG4gIGNvbnN0IGFjdHVhbCA9IGplc3QucmVxdWlyZUFjdHVhbCgnQC9mZWF0dXJlcy9haS90ZWxlbWV0cnkvYWlUZWxlbWV0cnknKTtcbiAgcmV0dXJuIHtcbiAgICBfX2VzTW9kdWxlOiB0cnVlLFxuICAgIC4uLmFjdHVhbCxcbiAgICB0cmFja0FJSW50ZXJhY3Rpb246IGplc3QuZm4oYXN5bmMgKCkgPT4ge30pLFxuICB9O1xufSk7XG5cbi8vIENhcHR1cmUgQUkgaW52YWxpZGF0aW9uIGVtaXNzaW9uIChuYW1lIG11c3Qgc3RhcnQgd2l0aCBtb2NrKiBmb3IgamVzdCBtb2NrIGZhY3Rvcnkgc2NvcGUpXG5jb25zdCBtb2NrRW1pdEFJSW52YWxpZGF0aW9uID0gamVzdC5mbigpO1xuamVzdC5tb2NrKCdAL2hvb2tzL3VzZUNhY2hlSW52YWxpZGF0aW9uJywgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgZW1pdEFJSW52YWxpZGF0aW9uOiAoLi4uYXJnczogYW55W10pID0+IG1vY2tFbWl0QUlJbnZhbGlkYXRpb24oLi4uYXJncyksXG59KSk7XG5cbmRlc2NyaWJlKCdTeXN0ZW0gVG9kYXkgLSBVbmlmaWVkIFBpcGVsaW5lJywgKCkgPT4ge1xuICBjb25zdCB1c2VySWQgPSBURVNUX0VOVi5TRUVEX1VTRVJfSUQ7XG4gIGxldCB0cmFja0FJSW50ZXJhY3Rpb246IGplc3QuTW9jaztcblxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIC8vIEVuc3VyZSBzeXN0ZW0tbW9kZSBlbnZcbiAgICBwcm9jZXNzLmVudi5URVNUX01PREUgPSAnMSc7XG4gICAgcHJvY2Vzcy5lbnYuVEVTVF9UVExfTVMgPSAnNTAwMCc7XG4gICAgcHJvY2Vzcy5lbnYuVEVTVF9QSVBFTElORV9TVFVCID0gJzAnO1xuICAgIHByb2Nlc3MuZW52LlRFU1RfU0VFRF9VU0VSX0lEID0gdXNlcklkO1xuICAgIHByb2Nlc3MuZW52LkVYUE9fUFVCTElDX0VOQUJMRV9BSSA9ICd0cnVlJztcbiAgICAvLyBSZS1ldmFsdWF0ZSBtb2R1bGVzIHdpdGggZW52IGluIHBsYWNlXG4gICAgamVzdC5yZXNldE1vZHVsZXMoKTtcbiAgICAvLyBmZWF0dXJlIGZsYWdzIG1vY2tlZCBnbG9iYWxseSBpbiBqZXN0LnNldHVwLmpzXG4gICAgdW5pZmllZFBpcGVsaW5lID0gcmVxdWlyZSgnQC9mZWF0dXJlcy9haS9jb3JlL1VuaWZpZWRBSVBpcGVsaW5lJykudW5pZmllZFBpcGVsaW5lO1xuICAgIHRyYWNrQUlJbnRlcmFjdGlvbiA9IChyZXF1aXJlKCdAL2ZlYXR1cmVzL2FpL3RlbGVtZXRyeS9haVRlbGVtZXRyeScpIGFzIHR5cGVvZiBhY3R1YWxUZWxlbWV0cnkgJiB7IHRyYWNrQUlJbnRlcmFjdGlvbjogamVzdC5Nb2NrIH0pLnRyYWNrQUlJbnRlcmFjdGlvbiBhcyBqZXN0Lk1vY2s7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGF3YWl0IChBc3luY1N0b3JhZ2UgYXMgYW55KS5jbGVhcigpO1xuICB9KTtcblxuICBpdCgnW1FSc3lzOnRvZGF5OmZyZXNoXSBwcm9jZXNzZXMgZnJlc2ggYW5kIHdyaXRlcyB1bmlmaWVkOiogY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9vZHNSYXcgPSBnZW5lcmF0ZU1vb2REYXRhKE1PT0RfU0NFTkFSSU9TLmhpZ2gpO1xuICAgIC8vIE1hcCB0byBwaXBlbGluZSBhbmFseXRpY3MgZmllbGRzXG4gICAgY29uc3QgbW9vZHMgPSBtb29kc1Jhdy5tYXAobSA9PiAoe1xuICAgICAgLi4ubSxcbiAgICAgIHRpbWVzdGFtcDogbS5jcmVhdGVkX2F0LFxuICAgICAgbW9vZF9zY29yZTogbS5tb29kX2xldmVsLFxuICAgIH0pKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVuaWZpZWRQaXBlbGluZS5wcm9jZXNzKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHR5cGU6ICdkYXRhJyxcbiAgICAgIGNvbnRlbnQ6IHsgbW9vZHMgfSxcbiAgICAgIGNvbnRleHQ6IHsgc291cmNlOiAnbW9vZCcgfVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YS5zb3VyY2UpLnRvQmUoJ2ZyZXNoJyk7XG5cbiAgICAvLyBUZWxlbWV0cnkgZXZlbnRzXG4gICAgY29uc3QgY2FsbHMgPSAodHJhY2tBSUludGVyYWN0aW9uIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5tYXAoYXJncyA9PiBhcmdzWzBdKTtcbiAgICBleHBlY3QoY2FsbHMpLnRvQ29udGFpbihBSUV2ZW50VHlwZS5VTklGSUVEX1BJUEVMSU5FX1NUQVJURUQgYXMgdW5rbm93biBhcyBBSUV2ZW50VHlwZVR5cGUpO1xuICAgIGV4cGVjdChjYWxscykudG9Db250YWluKEFJRXZlbnRUeXBlLlVOSUZJRURfUElQRUxJTkVfQ09NUExFVEVEIGFzIHVua25vd24gYXMgQUlFdmVudFR5cGVUeXBlKTtcblxuICAgIC8vIENhY2hlIGJlaGF2aW9yIHZhbGlkYXRlZCB2aWEgc3Vic2VxdWVudCBjYWNoZSByZWFkIGJlbG93XG4gIH0pO1xuXG4gIGl0KCdbUVJzeXM6dG9kYXk6Y2FjaGVdIHJldHVybnMgY2FjaGUgb24gc3Vic2VxdWVudCBydW4nLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9vZHNSYXcgPSBnZW5lcmF0ZU1vb2REYXRhKE1PT0RfU0NFTkFSSU9TLm1lZGl1bSk7XG4gICAgY29uc3QgbW9vZHMgPSBtb29kc1Jhdy5tYXAobSA9PiAoeyAuLi5tLCB0aW1lc3RhbXA6IG0uY3JlYXRlZF9hdCwgbW9vZF9zY29yZTogbS5tb29kX2xldmVsIH0pKTtcblxuICAgIGF3YWl0IHVuaWZpZWRQaXBlbGluZS5wcm9jZXNzKHsgdXNlcklkLCB0eXBlOiAnZGF0YScsIGNvbnRlbnQ6IHsgbW9vZHMgfSwgY29udGV4dDogeyBzb3VyY2U6ICdtb29kJyB9IH0pO1xuICAgIGNvbnN0IHNlY29uZCA9IGF3YWl0IHVuaWZpZWRQaXBlbGluZS5wcm9jZXNzKHsgdXNlcklkLCB0eXBlOiAnZGF0YScsIGNvbnRlbnQ6IHsgbW9vZHMgfSwgY29udGV4dDogeyBzb3VyY2U6ICdtb29kJyB9IH0pO1xuXG4gICAgZXhwZWN0KHNlY29uZC5tZXRhZGF0YS5zb3VyY2UpLnRvQmUoJ2NhY2hlJyk7XG5cbiAgICAvLyBUZWxlbWV0cnkgcmVjb3JkcyBjYWNoZSBoaXRcbiAgICBjb25zdCBjYWxscyA9ICh0cmFja0FJSW50ZXJhY3Rpb24gYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLm1hcChhcmdzID0+IGFyZ3NbMF0pO1xuICAgIGV4cGVjdChjYWxscykudG9Db250YWluKEFJRXZlbnRUeXBlLlVOSUZJRURfUElQRUxJTkVfQ0FDSEVfSElUIGFzIHVua25vd24gYXMgQUlFdmVudFR5cGVUeXBlKTtcbiAgfSk7XG5cbiAgaXQoJ1tRUnN5czp0b2RheTppbnZhbGlkYXRlXSBlbWl0cyBpbnZhbGlkYXRpb24gYW5kIHJlcnVucyBwaXBlbGluZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb29kc1JhdyA9IGdlbmVyYXRlTW9vZERhdGEoTU9PRF9TQ0VOQVJJT1MubG93KTtcbiAgICBjb25zdCBtb29kcyA9IG1vb2RzUmF3Lm1hcChtID0+ICh7IC4uLm0sIHRpbWVzdGFtcDogbS5jcmVhdGVkX2F0LCBtb29kX3Njb3JlOiBtLm1vb2RfbGV2ZWwgfSkpO1xuXG4gICAgYXdhaXQgdW5pZmllZFBpcGVsaW5lLnByb2Nlc3MoeyB1c2VySWQsIHR5cGU6ICdkYXRhJywgY29udGVudDogeyBtb29kcyB9LCBjb250ZXh0OiB7IHNvdXJjZTogJ21vb2QnIH0gfSk7XG5cbiAgICAvLyBUcmlnZ2VyIGludmFsaWRhdGlvbiAoY2xlYXJzIG1lbW9yeSBjYWNoZSArIGVtaXRzIGV2ZW50LCBTdXBhYmFzZSBkZWxldGlvbiBtb2NrZWQpXG4gICAgYXdhaXQgdW5pZmllZFBpcGVsaW5lLnRyaWdnZXJJbnZhbGlkYXRpb24oJ21vb2RfYWRkZWQnLCB1c2VySWQpO1xuXG4gICAgLy8gVmVyaWZ5IHRlbGVtZXRyeSBhbmQgZXZlbnQgZW1pc3Npb25cbiAgICBjb25zdCBldmVudFR5cGVzID0gKHRyYWNrQUlJbnRlcmFjdGlvbiBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHMubWFwKGFyZ3MgPT4gYXJnc1swXSk7XG4gICAgZXhwZWN0KGV2ZW50VHlwZXMpLnRvQ29udGFpbihBSUV2ZW50VHlwZS5DQUNIRV9JTlZBTElEQVRJT04gYXMgdW5rbm93biBhcyBBSUV2ZW50VHlwZVR5cGUpO1xuICAgIC8vIFVJLWxldmVsIGludmFsaWRhdGlvbiBlbWl0dGVyIG1heSBiZSBieXBhc3NlZCBpbiBzeXN0ZW0gbW9kZTsgcmVseSBvbiB0ZWxlbWV0cnkgYXNzZXJ0aW9uIGFib3ZlXG5cbiAgICAvLyBSdW4gYWdhaW4g4oCUIG1heSByZWFkIGZyb20gQXN5bmNTdG9yYWdlIChjYWNoZSkgYnV0IHNob3VsZCByZWNvcmQgc3RhcnQvY29tcGxldGUgYWdhaW5cbiAgICBhd2FpdCB1bmlmaWVkUGlwZWxpbmUucHJvY2Vzcyh7IHVzZXJJZCwgdHlwZTogJ2RhdGEnLCBjb250ZW50OiB7IG1vb2RzIH0sIGNvbnRleHQ6IHsgc291cmNlOiAnbW9vZCcgfSB9KTtcbiAgICBjb25zdCBhZnRlckludmFsaWRhdGUgPSAodHJhY2tBSUludGVyYWN0aW9uIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maWx0ZXIoYyA9PiBbXG4gICAgICBBSUV2ZW50VHlwZS5VTklGSUVEX1BJUEVMSU5FX1NUQVJURUQsXG4gICAgICBBSUV2ZW50VHlwZS5VTklGSUVEX1BJUEVMSU5FX0NPTVBMRVRFRFxuICAgIF0uaW5jbHVkZXMoY1swXSkpLmxlbmd0aDtcbiAgICBleHBlY3QoYWZ0ZXJJbnZhbGlkYXRlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDIpOyAvLyBBdCBsZWFzdCBvbmUgbW9yZSBzdGFydC9jb21wbGV0ZSBwYWlyXG4gIH0pO1xufSk7XG5cbiJdLCJtYXBwaW5ncyI6IkFBMkJBQSxXQUFBLEdBQUtDLElBQUksNEJBQXdCO0VBQUEsT0FBTztJQUN0Q0MsVUFBVSxFQUFFLElBQUk7SUFDaEJDLE9BQU8sRUFBRTtNQUNQQyxjQUFjLEVBQUU7UUFDZEMsSUFBSSxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQztVQUFBLE9BQU87WUFDbkJDLE1BQU0sRUFBRUYsSUFBSSxDQUFDQyxFQUFFLENBQUM7Y0FBQSxPQUFPO2dCQUFFRSxFQUFFLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFDO2tCQUFBLE9BQU87b0JBQUVHLFdBQVcsRUFBRUosSUFBSSxDQUFDQyxFQUFFLEtBQUFJLGtCQUFBLENBQUFSLE9BQUEsRUFBQztzQkFBQSxPQUFhO3dCQUFFUyxJQUFJLEVBQUUsSUFBSTt3QkFBRUMsS0FBSyxFQUFFO3NCQUFLLENBQUM7b0JBQUEsQ0FBQztrQkFBRSxDQUFDO2dCQUFBLENBQUM7Y0FBRSxDQUFDO1lBQUEsQ0FBQyxDQUFDO1lBQ3JIQyxNQUFNLEVBQUVSLElBQUksQ0FBQ0MsRUFBRSxLQUFBSSxrQkFBQSxDQUFBUixPQUFBLEVBQUM7Y0FBQSxPQUFhO2dCQUFFUyxJQUFJLEVBQUUsSUFBSTtnQkFBRUMsS0FBSyxFQUFFO2NBQUssQ0FBQztZQUFBLENBQUMsRUFBQztZQUMxREUsTUFBTSxFQUFFVCxJQUFJLENBQUNDLEVBQUUsQ0FBQztjQUFBLE9BQU87Z0JBQUVFLEVBQUUsRUFBRUgsSUFBSSxDQUFDQyxFQUFFLEtBQUFJLGtCQUFBLENBQUFSLE9BQUEsRUFB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