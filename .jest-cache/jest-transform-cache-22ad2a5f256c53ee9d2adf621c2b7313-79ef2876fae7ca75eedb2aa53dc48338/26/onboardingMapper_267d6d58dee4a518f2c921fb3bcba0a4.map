{"version":3,"names":["mapOnboardingPayloadToUserProfileRow","userId","payload","_payload$profile","_payload$lifestyle","_payload$lifestyle2","_payload$first_mood","_payload$first_mood2","_payload$profile2","_payload$profile3","_payload$profile4","_payload$reminders","_payload$lifestyle3","_payload$reminders2","_payload$reminders3","_payload$reminders4","_payload$consent","_payload$consent2","mapEnum","val","allowed","normalize","undefined","base","trim","toLowerCase","replace","includes","genderRaw","profile","gender","lifestyleExerciseRaw","lifestyle","exercise","lifestyleSocialRaw","social","lifestyle_exercise","lifestyle_social","motivations","Array","isArray","motivation","filter","m","firstMoodScoreRaw","first_mood","score","first_mood_score","Math","min","max","Number","first_mood_tags","tags","t","user_id","age","locale","timezone","reminders","lifestyle_sleep_hours","sleep_hours","reminder_enabled","enabled","reminder_time","time","reminder_days","days","feature_flags","consent_accepted","consent","accepted","consent_at","Date","toISOString","onboarding_version","onboarding_completed_at","updated_at"],"sources":["onboardingMapper.ts"],"sourcesContent":["export type OnboardingPayload = any;\n\n// Maps onboarding payload to user_profiles row body used for Supabase upsert\nexport function mapOnboardingPayloadToUserProfileRow(userId: string, payload: OnboardingPayload) {\n  const mapEnum = (val: any, allowed: string[], normalize?: (s: string) => string): string | undefined => {\n    if (!val || typeof val !== 'string') return undefined;\n    const base = (normalize ? normalize(val) : val).trim().toLowerCase().replace(/-/g, '_');\n    return allowed.includes(base) ? base : undefined;\n  };\n\n  const genderRaw = payload?.profile?.gender;\n  const lifestyleExerciseRaw = payload?.lifestyle?.exercise;\n  const lifestyleSocialRaw = payload?.lifestyle?.social;\n\n  const gender = mapEnum(genderRaw, ['female','male','non_binary','prefer_not_to_say']);\n  const lifestyle_exercise = mapEnum(lifestyleExerciseRaw, ['none','light','moderate','intense']);\n  const lifestyle_social = mapEnum(lifestyleSocialRaw, ['low','medium','high']);\n  const motivations = Array.isArray(payload?.motivation) ? payload.motivation.filter((m: any) => typeof m === 'string') : [];\n  const firstMoodScoreRaw = payload?.first_mood?.score;\n  const first_mood_score = typeof firstMoodScoreRaw === 'number' ? Math.min(5, Math.max(1, firstMoodScoreRaw)) : (firstMoodScoreRaw != null ? Number(firstMoodScoreRaw) : null);\n  const first_mood_tags = Array.isArray(payload?.first_mood?.tags) ? payload.first_mood.tags.filter((t: any) => typeof t === 'string') : [];\n\n  return {\n    user_id: userId,\n    age: payload?.profile?.age,\n    gender,\n    locale: payload?.profile?.locale,\n    timezone: payload?.profile?.timezone || payload?.reminders?.timezone,\n    motivations,\n    first_mood_score: first_mood_score != null ? Number(first_mood_score) : null,\n    first_mood_tags,\n    lifestyle_sleep_hours: payload?.lifestyle?.sleep_hours,\n    lifestyle_exercise,\n    lifestyle_social,\n    reminder_enabled: !!payload?.reminders?.enabled,\n    reminder_time: payload?.reminders?.time || null,\n    reminder_days: payload?.reminders?.days || [],\n    feature_flags: payload?.feature_flags || {},\n    consent_accepted: !!payload?.consent?.accepted,\n    consent_at: payload?.consent?.accepted ? new Date().toISOString() : null,\n    onboarding_version: 2,\n    onboarding_completed_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  };\n}\n\n"],"mappings":"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","ignoreList":[]}