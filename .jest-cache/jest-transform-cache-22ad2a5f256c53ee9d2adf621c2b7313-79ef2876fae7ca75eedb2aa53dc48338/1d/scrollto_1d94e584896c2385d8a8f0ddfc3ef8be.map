{"version":3,"names":["_jestMatcherUtils","require","_errors","_hostComponentNames","_object","_nativeState","_eventBuilder","_utils","_utils2","scrollTo","_x","_x2","_scrollTo","apply","arguments","_asyncToGenerator2","default","element","options","_options$contentSize$","_options$contentSize","_options$contentSize$2","_options$contentSize2","_nativeState$nativeSt","_dragSteps$at","_ref","_momentumSteps$at","isHostScrollView","ErrorWithStack","type","ensureScrollViewDirection","dispatchEvent","contentSize","width","height","initialOffset","nativeState","contentOffsetForElement","get","x","y","dragSteps","createScrollSteps","linearInterpolator","emitDragScrollEvents","config","momentumStart","at","momentumSteps","momentumY","momentumX","inertialInterpolator","emitMomentumScrollEvents","finalOffset","set","_x3","_x4","_x5","_x6","_emitDragScrollEvents","scrollSteps","scrollOptions","length","wait","EventBuilder","ScrollView","scroll","i","lastStep","_x7","_x8","_x9","_x0","_emitMomentumScrollEvents","isVerticalScrollView","props","horizontal","hasHorizontalScrollOptions","undefined","stringify","pick","hasVerticalScrollOptions"],"sources":["../../../src/user-event/scroll/scroll-to.ts"],"sourcesContent":["import type { ReactTestInstance } from 'react-test-renderer';\nimport { stringify } from 'jest-matcher-utils';\n\nimport { ErrorWithStack } from '../../helpers/errors';\nimport { isHostScrollView } from '../../helpers/host-component-names';\nimport { pick } from '../../helpers/object';\nimport { nativeState } from '../../native-state';\nimport type { Point, Size } from '../../types';\nimport { EventBuilder } from '../event-builder';\nimport type { UserEventConfig, UserEventInstance } from '../setup';\nimport { dispatchEvent, wait } from '../utils';\nimport { createScrollSteps, inertialInterpolator, linearInterpolator } from './utils';\n\ninterface CommonScrollToOptions {\n  contentSize?: Size;\n  layoutMeasurement?: Size;\n}\n\nexport interface VerticalScrollToOptions extends CommonScrollToOptions {\n  y: number;\n  momentumY?: number;\n\n  // Vertical scroll should not contain horizontal scroll part.\n  x?: never;\n  momentumX?: never;\n}\n\nexport interface HorizontalScrollToOptions extends CommonScrollToOptions {\n  x: number;\n  momentumX?: number;\n\n  // Horizontal scroll should not contain vertical scroll part.\n  y?: never;\n  momentumY?: never;\n}\n\nexport type ScrollToOptions = VerticalScrollToOptions | HorizontalScrollToOptions;\n\nexport async function scrollTo(\n  this: UserEventInstance,\n  element: ReactTestInstance,\n  options: ScrollToOptions,\n): Promise<void> {\n  if (!isHostScrollView(element)) {\n    throw new ErrorWithStack(\n      `scrollTo() works only with host \"ScrollView\" elements. Passed element has type \"${element.type}\".`,\n      scrollTo,\n    );\n  }\n\n  ensureScrollViewDirection(element, options);\n\n  await dispatchEvent(\n    element,\n    'contentSizeChange',\n    options.contentSize?.width ?? 0,\n    options.contentSize?.height ?? 0,\n  );\n\n  const initialOffset = nativeState.contentOffsetForElement.get(element) ?? { x: 0, y: 0 };\n  const dragSteps = createScrollSteps(\n    { y: options.y, x: options.x },\n    initialOffset,\n    linearInterpolator,\n  );\n  await emitDragScrollEvents(this.config, element, dragSteps, options);\n\n  const momentumStart = dragSteps.at(-1) ?? initialOffset;\n  const momentumSteps = createScrollSteps(\n    { y: options.momentumY, x: options.momentumX },\n    momentumStart,\n    inertialInterpolator,\n  );\n  await emitMomentumScrollEvents(this.config, element, momentumSteps, options);\n\n  const finalOffset = momentumSteps.at(-1) ?? dragSteps.at(-1) ?? initialOffset;\n  nativeState.contentOffsetForElement.set(element, finalOffset);\n}\n\nasync function emitDragScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: Point[],\n  scrollOptions: ScrollToOptions,\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  await dispatchEvent(\n    element,\n    'scrollBeginDrag',\n    EventBuilder.ScrollView.scroll(scrollSteps[0], scrollOptions),\n  );\n\n  // Note: experimentally, in case of drag scroll the last scroll step\n  // will not trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length - 1; i += 1) {\n    await wait(config);\n    await dispatchEvent(\n      element,\n      'scroll',\n      EventBuilder.ScrollView.scroll(scrollSteps[i], scrollOptions),\n    );\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  await dispatchEvent(\n    element,\n    'scrollEndDrag',\n    EventBuilder.ScrollView.scroll(lastStep, scrollOptions),\n  );\n}\n\nasync function emitMomentumScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: Point[],\n  scrollOptions: ScrollToOptions,\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  await dispatchEvent(\n    element,\n    'momentumScrollBegin',\n    EventBuilder.ScrollView.scroll(scrollSteps[0], scrollOptions),\n  );\n\n  // Note: experimentally, in case of momentum scroll the last scroll step\n  // will trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length; i += 1) {\n    await wait(config);\n    await dispatchEvent(\n      element,\n      'scroll',\n      EventBuilder.ScrollView.scroll(scrollSteps[i], scrollOptions),\n    );\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  await dispatchEvent(\n    element,\n    'momentumScrollEnd',\n    EventBuilder.ScrollView.scroll(lastStep, scrollOptions),\n  );\n}\n\nfunction ensureScrollViewDirection(element: ReactTestInstance, options: ScrollToOptions) {\n  const isVerticalScrollView = element.props.horizontal !== true;\n\n  const hasHorizontalScrollOptions = options.x !== undefined || options.momentumX !== undefined;\n  if (isVerticalScrollView && hasHorizontalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only vertical scroll options: \"y\" and \"momentumY\" for vertical \"ScrollView\" element but received ${stringify(\n        pick(options, ['x', 'momentumX']),\n      )}`,\n      scrollTo,\n    );\n  }\n\n  const hasVerticalScrollOptions = options.y !== undefined || options.momentumY !== undefined;\n  if (!isVerticalScrollView && hasVerticalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only horizontal scroll options: \"x\" and \"momentumX\" for horizontal \"ScrollView\" element but received ${stringify(\n        pick(options, ['y', 'momentumY']),\n      )}`,\n      scrollTo,\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}