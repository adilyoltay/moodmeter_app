{"version":3,"names":["_getJestObj","mock","__esModule","default","getItem","jest","fn","mockResolvedValue","setItem","undefined","removeItem","_interopRequireDefault","require","_asyncToGenerator2","_gamificationStore","_require","describe","beforeEach","useFakeTimers","setSystemTime","Date","init","useGamificationStore","getState","setState","Object","assign","profile","streakCurrent","streakBest","unlockedAchievements","healingPointsToday","healingPointsTotal","streakLevel","lastActivityDate","lastFirstActivityAwardDate","streakMilestonesAwarded","modulesActiveDate","modulesActiveToday","multiModuleDayAwarded","weekKey","activeDaysThisWeek","weeklyConsistencyAwarded","currentUserId","afterEach","useRealTimers","test","_useGamificationStore","updateStreak","getStreakInfo","info","expect","current","toBe","_useGamificationStore2","awardMicroReward","durationMs","difficulty","toBeGreaterThanOrEqual"],"sources":["gamification_streak.test.ts"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\nimport { useGamificationStore } from '@/store/gamificationStore';\n\njest.mock('@react-native-async-storage/async-storage', () => ({\n  __esModule: true,\n  default: {\n    getItem: jest.fn().mockResolvedValue(null),\n    setItem: jest.fn().mockResolvedValue(undefined),\n    removeItem: jest.fn().mockResolvedValue(undefined),\n  },\n}));\n\ndescribe('Gamification streak calculations', () => {\n  beforeEach(() => {\n    jest.useFakeTimers().setSystemTime(new Date('2025-09-07T10:00:00.000Z'));\n    // reset store\n    const init = useGamificationStore.getState();\n    useGamificationStore.setState({ ...init, profile: {\n      streakCurrent: 0,\n      streakBest: 0,\n      unlockedAchievements: [],\n      healingPointsToday: 0,\n      healingPointsTotal: 0,\n      streakLevel: 'seedling',\n      lastActivityDate: '2025-09-06',\n      lastFirstActivityAwardDate: undefined,\n      streakMilestonesAwarded: [],\n      modulesActiveDate: undefined,\n      modulesActiveToday: [],\n      multiModuleDayAwarded: 0,\n      weekKey: undefined,\n      activeDaysThisWeek: 0,\n      weeklyConsistencyAwarded: false,\n    }, currentUserId: 'test-user' });\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n  });\n\n  test('updateStreak increments across UTC day boundary', async () => {\n    const { updateStreak, getStreakInfo } = useGamificationStore.getState();\n    await updateStreak();\n    const info = getStreakInfo();\n    expect(info.current).toBe(1);\n  });\n\n  test('breathwork_completed also updates streak (daily activity)', async () => {\n    const { awardMicroReward, getStreakInfo } = useGamificationStore.getState();\n    await awardMicroReward('breathwork_completed', { durationMs: 600000, difficulty: 'medium' });\n    const info = getStreakInfo();\n    expect(info.current).toBeGreaterThanOrEqual(1);\n  });\n});\n\n"],"mappings":"AAGAA,WAAA,GAAKC,IAAI,CAAC,2CAA2C,EAAE;EAAA,OAAO;IAC5DC,UAAU,EAAE,IAAI;IAChBC,OAAO,EAAE;MACPC,OAAO,EAAEC,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAAC,IAAI,CAAC;MAC1CC,OAAO,EAAEH,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAACE,SAAS,CAAC;MAC/CC,UAAU,EAAEL,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAACE,SAAS;IACnD;EACF,CAAC;AAAA,CAAC,CAAC;AAAC,IAAAE,sBAAA,GAAAC,OAAA;AAAA,IAAAC,kBAAA,GAAAF,sBAAA,CAAAC,OAAA;AATJ,IAAAE,kBAAA,GAAAF,OAAA;AAAiE,SAAAZ,YAAA;EAAA,IAAAe,QAAA,GAAAH,OAAA;IAAAP,IAAA,GAAAU,QAAA,CAAAV,IAAA;EAAAL,WAAA,YAAAA,YAAA;IAAA,OAAAK,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAWjEW,QAAQ,CAAC,kCAAkC,EAAE,YAAM;EACjDC,UAAU,CAAC,YAAM;IACfZ,IAAI,CAACa,aAAa,CAAC,CAAC,CAACC,aAAa,CAAC,IAAIC,IAAI,CAAC,0BAA0B,CAAC,CAAC;IAExE,IAAMC,IAAI,GAAGC,uCAAoB,CAACC,QAAQ,CAAC,CAAC;IAC5CD,uCAAoB,CAACE,QAAQ,CAAAC,MAAA,CAAAC,MAAA,KAAML,IAAI;MAAEM,OAAO,EAAE;QAChDC,aAAa,EAAE,CAAC;QAChBC,UAAU,EAAE,CAAC;QACbC,oBAAoB,EAAE,EAAE;QACxBC,kBAAkB,EAAE,CAAC;QACrBC,kBAAkB,EAAE,CAAC;QACrBC,WAAW,EAAE,UAAU;QACvBC,gBAAgB,EAAE,YAAY;QAC9BC,0BAA0B,EAAE1B,SAAS;QACrC2B,uBAAuB,EAAE,EAAE;QAC3BC,iBAAiB,EAAE5B,SAAS;QAC5B6B,kBAAkB,EAAE,EAAE;QACtBC,qBAAqB,EAAE,CAAC;QACxBC,OAAO,EAAE/B,SAAS;QAClBgC,kBAAkB,EAAE,CAAC;QACrBC,wBAAwB,EAAE;MAC5B,CAAC;MAAEC,aAAa,EAAE;IAAW,EAAE,CAAC;EAClC,CAAC,CAAC;EAEFC,SAAS,CAAC,YAAM;IACdvC,IAAI,CAACwC,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFC,IAAI,CAAC,iDAAiD,MAAAjC,kBAAA,CAAAV,OAAA,EAAE,aAAY;IAClE,IAAA4C,qBAAA,GAAwCzB,uCAAoB,CAACC,QAAQ,CAAC,CAAC;MAA/DyB,YAAY,GAAAD,qBAAA,CAAZC,YAAY;MAAEC,aAAa,GAAAF,qBAAA,CAAbE,aAAa;IACnC,MAAMD,YAAY,CAAC,CAAC;IACpB,IAAME,IAAI,GAAGD,aAAa,CAAC,CAAC;IAC5BE,MAAM,CAACD,IAAI,CAACE,OAAO,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;EAC9B,CAAC,EAAC;EAEFP,IAAI,CAAC,2DAA2D,MAAAjC,kBAAA,CAAAV,OAAA,EAAE,aAAY;IAC5E,IAAAmD,sBAAA,GAA4ChC,uCAAoB,CAACC,QAAQ,CAAC,CAAC;MAAnEgC,gBAAgB,GAAAD,sBAAA,CAAhBC,gBAAgB;MAAEN,aAAa,GAAAK,sBAAA,CAAbL,aAAa;IACvC,MAAMM,gBAAgB,CAAC,sBAAsB,EAAE;MAAEC,UAAU,EAAE,MAAM;MAAEC,UAAU,EAAE;IAAS,CAAC,CAAC;IAC5F,IAAMP,IAAI,GAAGD,aAAa,CAAC,CAAC;IAC5BE,MAAM,CAACD,IAAI,CAACE,OAAO,CAAC,CAACM,sBAAsB,CAAC,CAAC,CAAC;EAChD,CAAC,EAAC;AACJ,CAAC,CAAC","ignoreList":[]}