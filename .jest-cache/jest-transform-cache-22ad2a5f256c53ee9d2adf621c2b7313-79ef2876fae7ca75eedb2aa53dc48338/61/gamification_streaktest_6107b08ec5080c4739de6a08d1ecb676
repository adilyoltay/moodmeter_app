ae016f89b719a850676e3950a09014c7
_getJestObj().mock('@react-native-async-storage/async-storage', function () {
  return {
    __esModule: true,
    default: {
      getItem: jest.fn().mockResolvedValue(null),
      setItem: jest.fn().mockResolvedValue(undefined),
      removeItem: jest.fn().mockResolvedValue(undefined)
    }
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _gamificationStore = require("../../store/gamificationStore");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe('Gamification streak calculations', function () {
  beforeEach(function () {
    jest.useFakeTimers().setSystemTime(new Date('2025-09-07T10:00:00.000Z'));
    var init = _gamificationStore.useGamificationStore.getState();
    _gamificationStore.useGamificationStore.setState(Object.assign({}, init, {
      profile: {
        streakCurrent: 0,
        streakBest: 0,
        unlockedAchievements: [],
        healingPointsToday: 0,
        healingPointsTotal: 0,
        streakLevel: 'seedling',
        lastActivityDate: '2025-09-06',
        lastFirstActivityAwardDate: undefined,
        streakMilestonesAwarded: [],
        modulesActiveDate: undefined,
        modulesActiveToday: [],
        multiModuleDayAwarded: 0,
        weekKey: undefined,
        activeDaysThisWeek: 0,
        weeklyConsistencyAwarded: false
      },
      currentUserId: 'test-user'
    }));
  });
  afterEach(function () {
    jest.useRealTimers();
  });
  test('updateStreak increments across UTC day boundary', (0, _asyncToGenerator2.default)(function* () {
    var _useGamificationStore = _gamificationStore.useGamificationStore.getState(),
      updateStreak = _useGamificationStore.updateStreak,
      getStreakInfo = _useGamificationStore.getStreakInfo;
    yield updateStreak();
    var info = getStreakInfo();
    expect(info.current).toBe(1);
  }));
  test('breathwork_completed also can be combined with updateStreak', (0, _asyncToGenerator2.default)(function* () {
    var _useGamificationStore2 = _gamificationStore.useGamificationStore.getState(),
      awardMicroReward = _useGamificationStore2.awardMicroReward,
      updateStreak = _useGamificationStore2.updateStreak,
      getStreakInfo = _useGamificationStore2.getStreakInfo;
    yield awardMicroReward('breathwork_completed', {
      durationMs: 600000,
      difficulty: 'medium'
    });
    yield updateStreak();
    var info = getStreakInfo();
    expect(info.current).toBeGreaterThanOrEqual(1);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImdldEl0ZW0iLCJqZXN0IiwiZm4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInNldEl0ZW0iLCJ1bmRlZmluZWQiLCJyZW1vdmVJdGVtIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfZ2FtaWZpY2F0aW9uU3RvcmUiLCJfcmVxdWlyZSIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsInVzZUZha2VUaW1lcnMiLCJzZXRTeXN0ZW1UaW1lIiwiRGF0ZSIsImluaXQiLCJ1c2VHYW1pZmljYXRpb25TdG9yZSIsImdldFN0YXRlIiwic2V0U3RhdGUiLCJPYmplY3QiLCJhc3NpZ24iLCJwcm9maWxlIiwic3RyZWFrQ3VycmVudCIsInN0cmVha0Jlc3QiLCJ1bmxvY2tlZEFjaGlldmVtZW50cyIsImhlYWxpbmdQb2ludHNUb2RheSIsImhlYWxpbmdQb2ludHNUb3RhbCIsInN0cmVha0xldmVsIiwibGFzdEFjdGl2aXR5RGF0ZSIsImxhc3RGaXJzdEFjdGl2aXR5QXdhcmREYXRlIiwic3RyZWFrTWlsZXN0b25lc0F3YXJkZWQiLCJtb2R1bGVzQWN0aXZlRGF0ZSIsIm1vZHVsZXNBY3RpdmVUb2RheSIsIm11bHRpTW9kdWxlRGF5QXdhcmRlZCIsIndlZWtLZXkiLCJhY3RpdmVEYXlzVGhpc1dlZWsiLCJ3ZWVrbHlDb25zaXN0ZW5jeUF3YXJkZWQiLCJjdXJyZW50VXNlcklkIiwiYWZ0ZXJFYWNoIiwidXNlUmVhbFRpbWVycyIsInRlc3QiLCJfdXNlR2FtaWZpY2F0aW9uU3RvcmUiLCJ1cGRhdGVTdHJlYWsiLCJnZXRTdHJlYWtJbmZvIiwiaW5mbyIsImV4cGVjdCIsImN1cnJlbnQiLCJ0b0JlIiwiX3VzZUdhbWlmaWNhdGlvblN0b3JlMiIsImF3YXJkTWljcm9SZXdhcmQiLCJkdXJhdGlvbk1zIiwiZGlmZmljdWx0eSIsInRvQmVHcmVhdGVyVGhhbk9yRXF1YWwiXSwic291cmNlcyI6WyJnYW1pZmljYXRpb25fc3RyZWFrLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFzeW5jU3RvcmFnZSBmcm9tICdAcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvYXN5bmMtc3RvcmFnZSc7XG5pbXBvcnQgeyB1c2VHYW1pZmljYXRpb25TdG9yZSB9IGZyb20gJ0Avc3RvcmUvZ2FtaWZpY2F0aW9uU3RvcmUnO1xuXG5qZXN0Lm1vY2soJ0ByZWFjdC1uYXRpdmUtYXN5bmMtc3RvcmFnZS9hc3luYy1zdG9yYWdlJywgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgZGVmYXVsdDoge1xuICAgIGdldEl0ZW06IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgICBzZXRJdGVtOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICByZW1vdmVJdGVtOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgfSxcbn0pKTtcblxuZGVzY3JpYmUoJ0dhbWlmaWNhdGlvbiBzdHJlYWsgY2FsY3VsYXRpb25zJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnVzZUZha2VUaW1lcnMoKS5zZXRTeXN0ZW1UaW1lKG5ldyBEYXRlKCcyMDI1LTA5LTA3VDEwOjAwOjAwLjAwMFonKSk7XG4gICAgLy8gcmVzZXQgc3RvcmVcbiAgICBjb25zdCBpbml0ID0gdXNlR2FtaWZpY2F0aW9uU3RvcmUuZ2V0U3RhdGUoKTtcbiAgICB1c2VHYW1pZmljYXRpb25TdG9yZS5zZXRTdGF0ZSh7IC4uLmluaXQsIHByb2ZpbGU6IHtcbiAgICAgIHN0cmVha0N1cnJlbnQ6IDAsXG4gICAgICBzdHJlYWtCZXN0OiAwLFxuICAgICAgdW5sb2NrZWRBY2hpZXZlbWVudHM6IFtdLFxuICAgICAgaGVhbGluZ1BvaW50c1RvZGF5OiAwLFxuICAgICAgaGVhbGluZ1BvaW50c1RvdGFsOiAwLFxuICAgICAgc3RyZWFrTGV2ZWw6ICdzZWVkbGluZycsXG4gICAgICBsYXN0QWN0aXZpdHlEYXRlOiAnMjAyNS0wOS0wNicsXG4gICAgICBsYXN0Rmlyc3RBY3Rpdml0eUF3YXJkRGF0ZTogdW5kZWZpbmVkLFxuICAgICAgc3RyZWFrTWlsZXN0b25lc0F3YXJkZWQ6IFtdLFxuICAgICAgbW9kdWxlc0FjdGl2ZURhdGU6IHVuZGVmaW5lZCxcbiAgICAgIG1vZHVsZXNBY3RpdmVUb2RheTogW10sXG4gICAgICBtdWx0aU1vZHVsZURheUF3YXJkZWQ6IDAsXG4gICAgICB3ZWVrS2V5OiB1bmRlZmluZWQsXG4gICAgICBhY3RpdmVEYXlzVGhpc1dlZWs6IDAsXG4gICAgICB3ZWVrbHlDb25zaXN0ZW5jeUF3YXJkZWQ6IGZhbHNlLFxuICAgIH0sIGN1cnJlbnRVc2VySWQ6ICd0ZXN0LXVzZXInIH0pO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xuICB9KTtcblxuICB0ZXN0KCd1cGRhdGVTdHJlYWsgaW5jcmVtZW50cyBhY3Jvc3MgVVRDIGRheSBib3VuZGFyeScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IHVwZGF0ZVN0cmVhaywgZ2V0U3RyZWFrSW5mbyB9ID0gdXNlR2FtaWZpY2F0aW9uU3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBhd2FpdCB1cGRhdGVTdHJlYWsoKTtcbiAgICBjb25zdCBpbmZvID0gZ2V0U3RyZWFrSW5mbygpO1xuICAgIGV4cGVjdChpbmZvLmN1cnJlbnQpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2JyZWF0aHdvcmtfY29tcGxldGVkIGFsc28gY2FuIGJlIGNvbWJpbmVkIHdpdGggdXBkYXRlU3RyZWFrJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgYXdhcmRNaWNyb1Jld2FyZCwgdXBkYXRlU3RyZWFrLCBnZXRTdHJlYWtJbmZvIH0gPSB1c2VHYW1pZmljYXRpb25TdG9yZS5nZXRTdGF0ZSgpO1xuICAgIGF3YWl0IGF3YXJkTWljcm9SZXdhcmQoJ2JyZWF0aHdvcmtfY29tcGxldGVkJywgeyBkdXJhdGlvbk1zOiA2MDAwMDAsIGRpZmZpY3VsdHk6ICdtZWRpdW0nIH0pO1xuICAgIGF3YWl0IHVwZGF0ZVN0cmVhaygpO1xuICAgIGNvbnN0IGluZm8gPSBnZXRTdHJlYWtJbmZvKCk7XG4gICAgZXhwZWN0KGluZm8uY3VycmVudCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBR0FBLFdBQUEsR0FBS0MsSUFBSSxDQUFDLDJDQUEyQyxFQUFFO0VBQUEsT0FBTztJQUM1REMsVUFBVSxFQUFFLElBQUk7SUFDaEJDLE9BQU8sRUFBRTtNQUNQQyxPQUFPLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsaUJBQWlCLENBQUMsSUFBSSxDQUFDO01BQzFDQyxPQUFPLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsaUJBQWlCLENBQUNFLFNBQVMsQ0FBQztNQUMvQ0MsVUFBVSxFQUFFTCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDLENBQUNDLGlCQUFpQixDQUFDRSxTQUFTO0lBQ25EO0VBQ0YsQ0FBQztBQUFBLENBQUMsQ0FBQztBQUFDLElBQUFFLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQyxrQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBVEosSUFBQUUsa0JBQUEsR0FBQUYsT0FBQTtBQUFpRSxTQUFBWixZQUFBO0VBQUEsSUFBQWUsUUFBQSxHQUFBSCxPQUFBO0lBQUFQLElBQUEsR0FBQVUsUUFBQSxDQUFBVixJQUFBO0VBQUFMLFdBQUEsWUFBQUEsWUFBQTtJQUFBLE9BQUFLLElBQUE7RUFBQTtFQUFBLE9BQUFBLElBQUE7QUFBQTtBQVdqRVcsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLFlBQU07RUFDakRDLFVBQVUsQ0FBQyxZQUFNO0lBQ2ZaLElBQUksQ0FBQ2EsYUFBYSxDQUFDLENBQUMsQ0FBQ0MsYUFBYSxDQUFDLElBQUlDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBRXhFLElBQU1DLElBQUksR0FBR0MsdUNBQW9CLENBQUNDLFFBQVEsQ0FBQyxDQUFDO0lBQzVDRCx1Q0FBb0IsQ0FBQ0UsUUFBUSxDQUFBQyxNQUFBLENBQUFDLE1BQUEsS0FBTUwsSUFBSTtNQUFFTSxPQUFPLEVBQUU7UUFDaERDLGFBQWEsRUFBRSxDQUFDO1FBQ2hCQyxVQUFVLEVBQUUsQ0FBQztRQUNiQyxvQkFBb0IsRUFBRSxFQUFFO1FBQ3hCQyxrQkFBa0IsRUFBRSxDQUFDO1FBQ3JCQyxrQkFBa0IsRUFBRSxDQUFDO1FBQ3JCQyxXQUFXLEVBQUUsVUFBVTtRQUN2QkMsZ0JBQWdCLEVBQUUsWUFBWTtRQUM5QkMsMEJBQTBCLEVBQUUxQixTQUFTO1FBQ3JDMkIsdUJBQXVCLEVBQUUsRUFBRTtRQUMzQkMsaUJBQWlCLEVBQUU1QixTQUFTO1FBQzVCNkIsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QkMscUJBQXFCLEVBQUUsQ0FBQztRQUN4QkMsT0FBTyxFQUFFL0IsU0FBUztRQUNsQmdDLGtCQUFrQixFQUFFLENBQUM7UUFDckJDLHdCQUF3QixFQUFFO01BQzVCLENBQUM7TUFBRUMsYUFBYSxFQUFFO0lBQVcsRUFBRSxDQUFDO0VBQ2xDLENBQUMsQ0FBQztFQUVGQyxTQUFTLENBQUMsWUFBTTtJQUNkdkMsSUFBSSxDQUFDd0MsYUFBYSxDQUFDLENBQUM7RUFDdEIsQ0FBQyxDQUFDO0VBRUZDLElBQUksQ0FBQyxpREFBaUQsTUFBQWpDLGtCQUFBLENBQUFWLE9BQUEsRUFBRSxhQUFZO0lBQ2xFLElBQUE0QyxxQkFBQSxHQUF3Q3pCLHVDQUFvQixDQUFDQyxRQUFRLENBQUMsQ0FBQztNQUEvRHlCLFlBQVksR0FBQUQscUJBQUEsQ0FBWkMsWUFBWTtNQUFFQyxhQUFhLEdBQUFGLHFCQUFBLENBQWJFLGFBQWE7SUFDbkMsTUFBTUQsWUFBWSxDQUFDLENBQUM7SUFDcEIsSUFBTUUsSUFBSSxHQUFHRCxhQUFhLENBQUMsQ0FBQztJQUM1QkUsTUFBTSxDQUFDRCxJQUFJLENBQUNFLE9BQU8sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0VBQzlCLENBQUMsRUFBQztFQUVGUCxJQUFJLENBQUMsNkRBQTZELE1BQUFqQyxrQkFBQSxDQUFBVixPQUFBLEVBQUUsYUFBWTtJQUM5RSxJQUFBbUQsc0JBQUEsR0FBMERoQyx1Q0FBb0IsQ0FBQ0MsUUFBUSxDQUFDLENBQUM7TUFBakZnQyxnQkFBZ0IsR0FBQUQsc0JBQUEsQ0FBaEJDLGdCQUFnQjtNQUFFUCxZQUFZLEdBQUFNLHNCQUFBLENBQVpOLFlBQVk7TUFBRUMsYUFBYSxHQUFBSyxzQkFBQSxDQUFiTCxhQUFhO0lBQ3JELE1BQU1NLGdCQUFnQixDQUFDLHNCQUFzQixFQUFFO01BQUVDLFVBQVUsRUFBRSxNQUFNO01BQUVDLFVBQVUsRUFBRTtJQUFTLENBQUMsQ0FBQztJQUM1RixNQUFNVCxZQUFZLENBQUMsQ0FBQztJQUNwQixJQUFNRSxJQUFJLEdBQUdELGFBQWEsQ0FBQyxDQUFDO0lBQzVCRSxNQUFNLENBQUNELElBQUksQ0FBQ0UsT0FBTyxDQUFDLENBQUNNLHNCQUFzQixDQUFDLENBQUMsQ0FBQztFQUNoRCxDQUFDLEVBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=